package Libraries.Interface

use Libraries.Game.GameInput
use Libraries.Game.InputSet
use Libraries.Interface.Events.KeyboardEvent
use Libraries.Interface.Events.MouseEvent
use Libraries.Game.GameStateManager
use Libraries.Game.InputTable
use Libraries.Interface.Controls.Scenes.SceneEditorInputTable
use Libraries.Interface.Behaviors.Scenes.Selection.all
use Libraries.Interface.Behaviors.Scenes.Camera.all
use Libraries.Interface.Behaviors.Scenes.Controls.all
use Libraries.Interface.Behaviors.Scenes.Grid.all
use Libraries.Interface.Behaviors.Scenes.Palette.all
use Libraries.Interface.Behaviors.Scenes.Properties.all
use Libraries.Interface.Behaviors.Blocks.all
use Libraries.Interface.Controls.Scenes.SceneConstants
use Libraries.Interface.Behaviors.Controls.all
use Libraries.Interface.Behaviors.Blocks.all
use Libraries.Interface.Behaviors.CancelBehavior
use Libraries.Interface.Behaviors.Behavior
use Libraries.Interface.Events.GestureEvent

shared class DefaultInputSets

    GameStateManager manager

    // These contain the constants for each key or type of mouse event
    KeyboardEvent keys
    MouseEvent mouse

    action GetUpArrowKey returns InputSet
        InputSet inputSet
        inputSet:SetKeyboardInput(keys:UP)
        return inputSet
    end

    action GetDownArrowKey returns InputSet
        InputSet inputSet
        inputSet:SetKeyboardInput(keys:DOWN)
        return inputSet
    end

    action GetLeftArrowKey returns InputSet
        InputSet inputSet
        inputSet:SetKeyboardInput(keys:LEFT)
        return inputSet
    end

    action GetRightArrowKey returns InputSet
        InputSet inputSet
        inputSet:SetKeyboardInput(keys:RIGHT)
        return inputSet
    end

    action GetLeftClick returns InputSet
        InputSet inputSet
        inputSet:SetMouseInput(mouse:LEFT)
        return inputSet
    end

    action GetRightClick returns InputSet
        InputSet inputSet
        inputSet:SetMouseInput(mouse:RIGHT)
        return inputSet
    end

    action GetTextInputSet returns InputSet
        InputSet textInputSet
        textInputSet:SetInputType(textInputSet:TEXT_INPUT)
        return textInputSet
    end

    action GetEnterKey returns InputSet
        InputSet inputSet
        inputSet:SetKeyboardInput(keys:ENTER)
        return inputSet
    end

    action AddShiftModifier(InputSet set) returns InputSet
        set:AddModifier(set:SHIFT)
        return set
    end

    action AddControlModifier(InputSet set) returns InputSet
        set:AddModifier(set:CONTROL)
        return set
    end

    action AddAltModifier(InputSet set) returns InputSet
        set:AddModifier(set:ALT)
        return set
    end

    action AddMetaModifier(InputSet set) returns InputSet
        set:AddModifier(set:META)
        return set
    end

    action SetupButtonInput(GameInput gameInput)
        InputTable buttonTable
        buttonTable:SetIdentifier("Button")

        InputSet clickDown
        clickDown:SetMouseInput(mouse:ANY)
        ButtonDownBehavior buttonDownBehavior
        buttonTable:Add(clickDown, buttonDownBehavior)

        InputSet clickUp
        clickUp:SetMouseInput(mouse:ANY)
        clickUp:SetInputTrigger(clickUp:FINISH)
        ButtonUpBehavior buttonUpBehavior
        buttonTable:Add(clickUp, buttonUpBehavior)

        InputSet touchDown
        touchDown:SetInputType(touchDown:TOUCH_INPUT)
        buttonTable:Add(touchDown, buttonDownBehavior)

        InputSet touchUp
        touchUp:SetInputType(touchUp:TOUCH_INPUT)
        touchUp:SetInputTrigger(touchUp:FINISH)
        buttonTable:Add(touchUp, buttonUpBehavior)

        InputSet mouseOn
        mouseOn:SetInputType(mouseOn:MOUSE_MOVEMENT_INPUT)
        mouseOn:SetInputTrigger(mouseOn:BEGIN)
        MouseOnBehavior onBehavior
        buttonTable:Add(mouseOn, onBehavior)

        InputSet mouseOff
        mouseOff:SetInputType(mouseOff:MOUSE_MOVEMENT_INPUT)
        mouseOff:SetInputTrigger(mouseOff:FINISH)
        ButtonMouseOffBehavior buttonOffBehavior
        buttonTable:Add(mouseOff, buttonOffBehavior)
        
        InputSet spaceSet
        spaceSet:SetKeyboardInput(keys:SPACE)
        InputSet numpadEnterSet
        numpadEnterSet:SetKeyboardInput(keys:NUMPAD_ENTER)
        ControlActivationBehavior activateBehavior
        buttonTable:Add(spaceSet, activateBehavior)
        buttonTable:Add(GetEnterKey(), activateBehavior)
        buttonTable:Add(numpadEnterSet, activateBehavior)

        OpenPopupMenuBehavior openContextMenuBehavior
        buttonTable:Add(GetRightClick(), openContextMenuBehavior)

        if manager:GetOperatingSystem():Contains("OS X")
            buttonTable:Add(AddControlModifier(GetLeftClick()), openContextMenuBehavior)
        end

        gameInput:AddInputTable(buttonTable)
    end

    action SetupButtonGroupInput(GameInput gameInput)
        InputTable groupTable
        groupTable:SetIdentifier("ButtonGroup")

        ButtonGroupUpBehavior groupUpFocus
        ButtonGroupDownBehavior groupDownFocus
        groupTable:Add(GetUpArrowKey(), groupUpFocus)
        groupTable:Add(GetDownArrowKey(), groupDownFocus)
        groupTable:Add(GetLeftArrowKey(), groupUpFocus)
        groupTable:Add(GetRightArrowKey(), groupDownFocus)

        gameInput:AddInputTable(groupTable)
    end

    action SetupToolbarInput(GameInput gameInput)
        InputTable toolbarTable
        toolbarTable:SetIdentifier("ToolBar")

        NavigateFocusUpToolBar upFocus
        NavigateFocusDownToolBar downFocus

        toolbarTable:Add(GetUpArrowKey(), upFocus)
        toolbarTable:Add(GetDownArrowKey(), downFocus)
        toolbarTable:Add(GetLeftArrowKey(), upFocus)
        toolbarTable:Add(GetRightArrowKey(), downFocus)
        gameInput:AddInputTable(toolbarTable)
    end

    action SetupDialogInput(GameInput gameInput)
        InputTable dialogTable
        dialogTable:SetIdentifier("Dialog")

        InputSet numpadEnter
        numpadEnter:SetKeyboardInput(keys:NUMPAD_ENTER)
        DialogEnterBehavior dialogEnterBehavior
        dialogTable:Add(GetEnterKey(), dialogEnterBehavior)
        dialogTable:Add(numpadEnter, dialogEnterBehavior)

        InputSet dialogEscape
        dialogEscape:SetKeyboardInput(keys:ESCAPE)
        DialogEscapeBehavior dialogEscapeBehavior
        dialogTable:Add(dialogEscape, dialogEscapeBehavior)

        gameInput:AddInputTable(dialogTable)
    end

    action SetupTabPaneInput(GameInput gameInput)
        InputTable tabPaneTable
        tabPaneTable:SetIdentifier("TabPane")

        TabPaneForwardTabBehavior forward
        TabPaneBackwardTabBehavior backward
        TabPaneCloseTabBehavior closeTab

        if manager:GetOperatingSystem():Contains("OS X")
            InputSet forwardTab
            forwardTab:SetKeyboardInput(keys:RIGHT_BRACKET)
            forwardTab:AddModifier(forwardTab:CONTROL)
            tabPaneTable:Add(forwardTab, forward)

            InputSet backwardTab
            backwardTab:SetKeyboardInput(keys:LEFT_BRACKET)
            backwardTab:AddModifier(forwardTab:CONTROL)
            tabPaneTable:Add(backwardTab, backward)

            InputSet closeTabSet
            closeTabSet:SetKeyboardInput(keys:W)
            closeTabSet:AddModifier(forwardTab:META)
            tabPaneTable:Add(closeTabSet, closeTab)
        else
            InputSet forwardTab
            forwardTab:SetKeyboardInput(keys:TAB)
            forwardTab:AddModifier(forwardTab:CONTROL)

            tabPaneTable:Add(forwardTab, forward)

            InputSet backwardTab
            backwardTab:SetKeyboardInput(keys:TAB)
            backwardTab:AddModifier(forwardTab:SHIFT)
            backwardTab:AddModifier(forwardTab:CONTROL)

            tabPaneTable:Add(backwardTab, backward)

            InputSet closeTabSet
            closeTabSet:SetKeyboardInput(keys:F4)
            closeTabSet:AddModifier(forwardTab:CONTROL)
            tabPaneTable:Add(closeTabSet, closeTab)
        end
        
        gameInput:AddInputTable(tabPaneTable)
    end

    action SetupMenuInput(GameInput gameInput)
        InputTable menuItemTable
        menuItemTable:SetIdentifier("MenuItem")

        InputSet clickDown
        clickDown:SetMouseInput(mouse:ANY)

        InputSet clickUp
        clickUp:SetMouseInput(mouse:ANY)
        clickUp:SetInputTrigger(clickUp:FINISH)

        InputSet touchDown
        touchDown:SetInputType(touchDown:TOUCH_INPUT)

        InputSet touchUp
        touchUp:SetInputType(touchUp:TOUCH_INPUT)
        touchUp:SetInputTrigger(touchUp:FINISH)

        InputSet mouseOn
        mouseOn:SetInputType(mouseOn:MOUSE_MOVEMENT_INPUT)
        mouseOn:SetInputTrigger(mouseOn:BEGIN)
        MouseOnBehavior onBehavior

        ClickDownBehavior downBehavior
        ClickUpBehavior upBehavior

        menuItemTable:Add(clickDown, downBehavior)
        menuItemTable:Add(clickUp, upBehavior)
        menuItemTable:Add(touchDown, downBehavior)
        menuItemTable:Add(touchUp, upBehavior)
        menuItemTable:Add(mouseOn, onBehavior)

        gameInput:AddInputTable(menuItemTable)


        InputTable menuRootTable
        menuRootTable:SetIdentifier("MenuRoot")

        MenuRootDownBehavior menuDownBehavior
        MenuRootUpBehavior menuUpBehavior
        MenuRootLeftBehavior menuLeftBehavior
        MenuRootRightBehavior menuRightBehavior
        MenuRootActivateBehavior menuRunBehavior
        MenuRootCloseBehavior menuCloseBehavior

        menuRootTable:Add(GetDownArrowKey(), menuDownBehavior)
        menuRootTable:Add(GetUpArrowKey(), menuUpBehavior)
        menuRootTable:Add(GetLeftArrowKey(), menuLeftBehavior)
        menuRootTable:Add(GetRightArrowKey(), menuRightBehavior)

        MenuMnemonicBehavior mnemonicBehavior
        InputSet textInputSet
        textInputSet:SetInputType(textInputSet:TEXT_INPUT)
        menuRootTable:Add(textInputSet, mnemonicBehavior)

        InputSet spaceBar
        spaceBar:SetKeyboardInput(keys:SPACE)

        menuRootTable:Add(spaceBar, menuRunBehavior)
        menuRootTable:Add(GetEnterKey(), menuRunBehavior)

        InputSet escapeSet
        escapeSet:SetKeyboardInput(keys:ESCAPE)
        menuRootTable:Add(escapeSet, menuCloseBehavior)

        gameInput:AddInputTable(menuRootTable)

        InputTable scrollableMenuTable
        scrollableMenuTable:SetIdentifier("ScrollableMenuPanel")

        ScrollableMenuPanelBeginDraggingBehavior menuBeginDraggingBehavior
        scrollableMenuTable:Add(GetLeftClick(), menuBeginDraggingBehavior)

        InputSet leftClickDrag
        leftClickDrag = GetLeftClick()
        leftClickDrag:SetInputTrigger(leftClickDrag:CONTINUE)
        ScrollableMenuPanelDragBehavior menuDragBehavior
        scrollableMenuTable:Add(leftClickDrag, menuDragBehavior)

        InputSet leftClickUp
        leftClickUp = GetLeftClick()
        leftClickUp:SetInputTrigger(leftClickUp:FINISH)
        ScrollableMenuPanelStopDraggingBehavior menuStopDraggingBehavior
        scrollableMenuTable:Add(leftClickUp, menuStopDraggingBehavior)

        InputSet mouseScroll
        mouseScroll:SetInputType(mouseScroll:MOUSE_WHEEL_INPUT)
        ScrollableMenuPanelScrollBehavior menuScrollBehavior
        scrollableMenuTable:Add(mouseScroll, menuScrollBehavior)

        gameInput:AddInputTable(scrollableMenuTable)

    end

    action SetupTreeInput(GameInput gameInput)
        InputTable treeItemTable
        treeItemTable:SetIdentifier("TreeItem")
        InputSet doubleClickSet
        doubleClickSet:SetMouseInput(mouse:LEFT)
        doubleClickSet:SetEventCount(2)
        InputSet doubleTouchSet
        doubleTouchSet:SetInputType(doubleTouchSet:TOUCH_INPUT)
        doubleTouchSet:SetEventCount(2)
        TreeDoubleClickBehavior doubleClickBehavior
        treeItemTable:Add(doubleClickSet, doubleClickBehavior)
        treeItemTable:Add(doubleTouchSet, doubleClickBehavior)

        InputSet clickSet
        clickSet:SetMouseInput(mouse:LEFT)

        InputSet touchDown
        touchDown:SetInputType(touchDown:TOUCH_INPUT)

        ClickDownBehavior clickDownBehavior
        treeItemTable:Add(clickSet, clickDownBehavior)
        treeItemTable:Add(touchDown, clickDownBehavior)

        InputSet rightClickSet
        rightClickSet:SetMouseInput(mouse:RIGHT)
        TreeOpenPopupMenuBehavior treeOpenContextMenuBehavior
        treeItemTable:Add(rightClickSet, treeOpenContextMenuBehavior)

        if manager:GetOperatingSystem():Contains("OS X")
            InputSet rightClickControlSet
            rightClickControlSet:SetMouseInput(mouse:LEFT)
            rightClickControlSet:AddModifier(rightClickControlSet:CONTROL)
            treeItemTable:Add(rightClickControlSet, treeOpenContextMenuBehavior)
        end

        gameInput:AddInputTable(treeItemTable)

        InputTable treeTable
        treeTable:SetIdentifier("Tree")

        TreeLeftBehavior treeLeftBehavior
        treeTable:Add(GetLeftArrowKey(), treeLeftBehavior)
        
        TreeRightBehavior treeRightBehavior
        treeTable:Add(GetRightArrowKey(), treeRightBehavior)

        TreeDownBehavior treeDownBehavior
        treeTable:Add(GetDownArrowKey(), treeDownBehavior)

        TreeUpBehavior treeUpBehavior
        treeTable:Add(GetUpArrowKey(), treeUpBehavior)

        InputSet homeSet
        homeSet:SetKeyboardInput(keys:HOME)
        TreeSelectFirstBehavior treeSelectFirstBehavior
        treeTable:Add(homeSet, treeSelectFirstBehavior)

        InputSet endSet
        endSet:SetKeyboardInput(keys:END)
        TreeSelectLastBehavior treeSelectLastBehavior
        treeTable:Add(endSet, treeSelectLastBehavior)

        InputSet numpadEnterSet
        numpadEnterSet:SetKeyboardInput(keys:NUMPAD_ENTER)
        TreeActivateBehavior treeActivateBehavior
        treeTable:Add(GetEnterKey(), treeActivateBehavior)
        treeTable:Add(numpadEnterSet, treeActivateBehavior)

        // On Windows, Shift-F10 opens context menus just like right-clicking.
        InputSet shiftF10Set
        shiftF10Set:SetKeyboardInput(keys:F10)
        shiftF10Set:AddModifier(shiftF10Set:SHIFT)
        treeTable:Add(shiftF10Set, treeOpenContextMenuBehavior)

        InputSet textInputSet
        textInputSet:SetInputType(textInputSet:TEXT_INPUT)
        FirstLetterNavigateBehavior firstLetterNavigateBehavior
        treeTable:Add(textInputSet, firstLetterNavigateBehavior)

        gameInput:AddInputTable(treeTable)
    end

    action SetupSpreadsheetInput(GameInput gameInput)
        InputTable spreadsheetTable
        spreadsheetTable:SetIdentifier("Spreadsheet")
        SpreadsheetCopyBehavior spreadsheetCopyBehavior
        SpreadsheetCutBehavior spreadsheetCutBehavior
        SpreadsheetPasteBehavior spreadsheetPasteBehavior
        SpreadsheetDownBehavior spreadsheetDownBehavior
        SpreadsheetUpBehavior spreadsheetUpBehavior
        SpreadsheetLeftBehavior spreadsheetLeftBehavior
        SpreadsheetRightBehavior spreadsheetRightBehavior
        SpreadsheetActivationBehavior spreadsheetActivate

        spreadsheetTable:Add(GetDownArrowKey(), spreadsheetDownBehavior)
        spreadsheetTable:Add(GetUpArrowKey(), spreadsheetUpBehavior)
        spreadsheetTable:Add(GetLeftArrowKey(), spreadsheetLeftBehavior)
        spreadsheetTable:Add(GetRightArrowKey(), spreadsheetRightBehavior)

        spreadsheetTable:Add(GetEnterKey(), spreadsheetActivate)

        //copy past for fields
        if manager:GetOperatingSystem():Contains("OS X")
            //first do copy paste
            InputSet metaC
            metaC:SetKeyboardInput(keys:C)
            metaC:AddModifier(metaC:META)
            spreadsheetTable:Add(metaC, spreadsheetCopyBehavior)

            InputSet metaX
            metaX:SetKeyboardInput(keys:X)
            metaX:AddModifier(metaX:META)
            spreadsheetTable:Add(metaX, spreadsheetCutBehavior)

            InputSet metaV
            metaV:SetKeyboardInput(keys:V)
            metaV:AddModifier(metaV:META)
            spreadsheetTable:Add(metaV, spreadsheetPasteBehavior)
        else
            InputSet controlC
            controlC:SetKeyboardInput(keys:C)
            controlC:AddModifier(controlC:CONTROL)
            spreadsheetTable:Add(controlC, spreadsheetCopyBehavior)

            InputSet controlX
            controlX:SetKeyboardInput(keys:X)
            controlX:AddModifier(controlX:CONTROL)
            spreadsheetTable:Add(controlX, spreadsheetCutBehavior)

            InputSet controlV
            controlV:SetKeyboardInput(keys:V)
            controlV:AddModifier(controlV:CONTROL)
            spreadsheetTable:Add(controlV, spreadsheetPasteBehavior)
        end

        gameInput:AddInputTable(spreadsheetTable)

        InputTable spreadsheetCellTable
        spreadsheetCellTable:SetIdentifier("SpreadsheetCell")

        InputSet doubleClickSet
        doubleClickSet:SetMouseInput(mouse:LEFT)
        doubleClickSet:SetEventCount(2)

        InputSet clickDown
        clickDown:SetMouseInput(mouse:ANY)

        InputSet clickUp
        clickUp:SetMouseInput(mouse:ANY)
        clickUp:SetInputTrigger(clickUp:FINISH)

        InputSet touchDown
        touchDown:SetInputType(touchDown:TOUCH_INPUT)

        InputSet touchUp
        touchUp:SetInputType(touchUp:TOUCH_INPUT)
        touchUp:SetInputTrigger(touchUp:FINISH)

        ClickDownBehavior downBehavior
        ClickUpBehavior upBehavior

        spreadsheetCellTable:Add(clickDown, downBehavior)
        spreadsheetCellTable:Add(touchDown, downBehavior)
        spreadsheetCellTable:Add(clickUp, upBehavior)
        spreadsheetCellTable:Add(touchUp, upBehavior)
        spreadsheetCellTable:Add(doubleClickSet, spreadsheetActivate)

        gameInput:AddInputTable(spreadsheetCellTable)
    end

    action SetupTreeTableInput(GameInput gameInput)
        InputTable treeTableInputTable
        treeTableInputTable:SetIdentifier("TreeTable")
        TreeTableDownBehavior treeTableDownBehavior
        TreeTableUpBehavior treeTableUpBehavior
        TreeTableLeftBehavior treeTableLeftBehavior
        TreeTableRightBehavior treeTableRightBehavior
        TreeTableActivationBehavior treeTableActivate

        treeTableInputTable:Add(GetDownArrowKey(), treeTableDownBehavior)
        treeTableInputTable:Add(GetUpArrowKey(), treeTableUpBehavior)
        treeTableInputTable:Add(GetLeftArrowKey(), treeTableLeftBehavior)
        treeTableInputTable:Add(GetRightArrowKey(), treeTableRightBehavior)

        InputSet spaceSet
        spaceSet:SetKeyboardInput(keys:SPACE)
        treeTableInputTable:Add(spaceSet, treeTableActivate)
        FirstLetterNavigateBehavior firstLetterNavigateBehavior
        treeTableInputTable:Add(GetTextInputSet(), firstLetterNavigateBehavior)

        gameInput:AddInputTable(treeTableInputTable)

        InputTable treeTableCellTable
        treeTableCellTable:SetIdentifier("TreeTableCell")

        InputSet doubleClickSet
        doubleClickSet:SetMouseInput(mouse:LEFT)
        doubleClickSet:SetEventCount(2)

        InputSet clickDown
        clickDown:SetMouseInput(mouse:ANY)

        InputSet clickUp
        clickUp:SetMouseInput(mouse:ANY)
        clickUp:SetInputTrigger(clickUp:FINISH)

        InputSet touchDown
        touchDown:SetInputType(touchDown:TOUCH_INPUT)

        InputSet touchUp
        touchUp:SetInputType(touchUp:TOUCH_INPUT)
        touchUp:SetInputTrigger(touchUp:FINISH)

        ClickDownBehavior downBehavior
        ClickUpBehavior upBehavior

        treeTableCellTable:Add(clickDown, downBehavior)
        treeTableCellTable:Add(touchDown, downBehavior)
        treeTableCellTable:Add(clickUp, upBehavior)
        treeTableCellTable:Add(touchUp, upBehavior)
        treeTableCellTable:Add(doubleClickSet, treeTableActivate)

        gameInput:AddInputTable(treeTableCellTable)
    end

    action SetupListInput(GameInput gameInput)
        InputTable listInputTable
        listInputTable:SetIdentifier("List")
        ListDownBehavior listDownBehavior
        ListUpBehavior listUpBehavior
        ListActivationBehavior listActivate

        listInputTable:Add(GetDownArrowKey(), listDownBehavior)
        listInputTable:Add(GetUpArrowKey(), listUpBehavior)
        InputSet spaceSet
        spaceSet:SetKeyboardInput(keys:SPACE)
        listInputTable:Add(spaceSet, listActivate)

        FirstLetterNavigateBehavior firstLetterNavigateBehavior
        listInputTable:Add(GetTextInputSet(), firstLetterNavigateBehavior)

        ListHomeBehavior homeBehavior
        ListEndBehavior endBehavior

        InputSet homeKey
        homeKey:SetKeyboardInput(keys:HOME)
        InputSet endKey
        endKey:SetKeyboardInput(keys:END)

        listInputTable:Add(homeKey, homeBehavior)
        listInputTable:Add(endKey, endBehavior)

        InputSet mouseScrollSet
        mouseScrollSet:SetInputType(mouseScrollSet:MOUSE_WHEEL_INPUT)
        ScrollableControlMouseScrollBehavior scrollBehavior
        listInputTable:Add(mouseScrollSet, scrollBehavior)

        gameInput:AddInputTable(listInputTable)

        InputTable listItemTable
        listItemTable:SetIdentifier("ListItem")

        InputSet doubleClickSet
        doubleClickSet:SetMouseInput(mouse:LEFT)
        doubleClickSet:SetEventCount(2)

        InputSet clickDown
        clickDown:SetMouseInput(mouse:ANY)

        InputSet touchDown
        touchDown:SetInputType(touchDown:TOUCH_INPUT)

        ClickDownBehavior downBehavior
        ClickUpBehavior upBehavior

        listItemTable:Add(clickDown, downBehavior)
        listItemTable:Add(touchDown, upBehavior)
        listItemTable:Add(doubleClickSet, listActivate)

        gameInput:AddInputTable(listItemTable)
    end

    action SetupGutterInput(GameInput gameInput)
        InputTable gutterTable
        gutterTable:SetIdentifier("Gutter")

        InputSet clickDown
        clickDown:SetMouseInput(mouse:ANY)

        GutterClickBehavior gutterClickBehavior
        gutterTable:Add(clickDown, gutterClickBehavior)

        gameInput:AddInputTable(gutterTable)
    end

    action SetupTextBoxInput(GameInput gameInput)
        InputTable textBoxTable
        textBoxTable:SetIdentifier("TextBox")

        InputSet numpadEnter
        numpadEnter:SetKeyboardInput(keys:NUMPAD_ENTER)

        if manager:GetOperatingSystem():Contains("OS X")
            //first do copy paste
            InputSet textBoxControlC
            textBoxControlC:SetKeyboardInput(keys:C)
            textBoxControlC:AddModifier(textBoxControlC:META)
            TextBoxCopyToClipboardBehavior textBoxCopyToClipboardBehavior
            textBoxTable:Add(textBoxControlC, textBoxCopyToClipboardBehavior)

            InputSet textBoxControlX
            textBoxControlX:SetKeyboardInput(keys:X)
            textBoxControlX:AddModifier(textBoxControlC:META)
            TextBoxCutToClipboardBehavior textBoxCutToClipboardBehavior
            textBoxTable:Add(textBoxControlX, textBoxCutToClipboardBehavior)

            InputSet textBoxControlV
            textBoxControlV:SetKeyboardInput(keys:V)
            textBoxControlV:AddModifier(textBoxControlC:META)
            TextBoxPasteFromClipboardBehavior textBoxPasteFromClipboardBehavior
            textBoxTable:Add(textBoxControlV, textBoxPasteFromClipboardBehavior)

            //now do undo/redo
            InputSet textBoxControlZ
            textBoxControlZ:SetKeyboardInput(keys:Z)
            textBoxControlZ:AddModifier(textBoxControlZ:META)
            TextBoxUndoBehavior textBoxUndoBehavior
            textBoxTable:Add(textBoxControlZ, textBoxUndoBehavior)

            InputSet textBoxControlY
            textBoxControlY:SetKeyboardInput(keys:Y)
            textBoxControlY:AddModifier(textBoxControlY:META)
            TextBoxRedoBehavior textBoxRedoBehavior
            textBoxTable:Add(textBoxControlY, textBoxRedoBehavior)

            //Selection
            InputSet textBoxControlA
            textBoxControlA:SetKeyboardInput(keys:A)
            textBoxControlA:AddModifier(textBoxControlA:META)
            TextBoxSelectAllBehavior textBoxSelectAllBehavior
            textBoxTable:Add(textBoxControlA, textBoxSelectAllBehavior)

            InputSet textBoxControlHome
            textBoxControlHome:SetKeyboardInput(keys:UP)
            textBoxControlHome:AddModifier(textBoxControlHome:META)
            TextBoxCaretToDocumentStartBehavior textBoxCaretToDocumentStartBehavior
            textBoxTable:Add(textBoxControlHome, textBoxCaretToDocumentStartBehavior)

            InputSet textBoxControlEnd
            textBoxControlEnd:SetKeyboardInput(keys:DOWN)
            textBoxControlEnd:AddModifier(textBoxControlEnd:META)
            TextBoxCaretToDocumentEndBehavior textBoxCaretToDocumentEndBehavior
            textBoxTable:Add(textBoxControlEnd, textBoxCaretToDocumentEndBehavior)

            InputSet textBoxShiftControlHome
            textBoxShiftControlHome:SetKeyboardInput(keys:UP)
            textBoxShiftControlHome:AddModifier(textBoxShiftControlHome:SHIFT)
            textBoxShiftControlHome:AddModifier(textBoxShiftControlHome:META)
            TextBoxSelectToDocumentStartBehavior textBoxSelectToDocumentStartBehavior
            textBoxTable:Add(textBoxShiftControlHome, textBoxSelectToDocumentStartBehavior)

            InputSet textBoxShiftControlEnd
            textBoxShiftControlEnd:SetKeyboardInput(keys:DOWN)
            textBoxShiftControlEnd:AddModifier(textBoxShiftControlEnd:SHIFT)
            textBoxShiftControlEnd:AddModifier(textBoxShiftControlEnd:META)
            TextBoxSelectToDocumentEndBehavior textBoxSelectToDocumentEndBehavior
            textBoxTable:Add(textBoxShiftControlEnd, textBoxCaretToDocumentEndBehavior)

            InputSet textBoxAltRight
            textBoxAltRight:SetKeyboardInput(keys:RIGHT)
            textBoxAltRight:AddModifier(textBoxAltRight:ALT)
            TextBoxCaretToTokenEndBehavior textBoxCaretToTokenEndBehavior
            textBoxTable:Add(textBoxAltRight, textBoxCaretToTokenEndBehavior)

            InputSet textBoxAltLeft
            textBoxAltLeft:SetKeyboardInput(keys:LEFT)
            textBoxAltLeft:AddModifier(textBoxAltLeft:ALT)
            TextBoxCaretToTokenStartBehavior textBoxCaretToTokenStartBehavior
            textBoxTable:Add(textBoxAltLeft, textBoxCaretToTokenStartBehavior)

        else
            InputSet textBoxControlC
            textBoxControlC:SetKeyboardInput(keys:C)
            textBoxControlC:AddModifier(textBoxControlC:CONTROL)
            TextBoxCopyToClipboardBehavior textBoxCopyToClipboardBehavior
            textBoxTable:Add(textBoxControlC, textBoxCopyToClipboardBehavior)

            InputSet textBoxControlX
            textBoxControlX:SetKeyboardInput(keys:X)
            textBoxControlX:AddModifier(textBoxControlC:CONTROL)
            TextBoxCutToClipboardBehavior textBoxCutToClipboardBehavior
            textBoxTable:Add(textBoxControlX, textBoxCutToClipboardBehavior)

            InputSet textBoxControlV
            textBoxControlV:SetKeyboardInput(keys:V)
            textBoxControlV:AddModifier(textBoxControlC:CONTROL)
            TextBoxPasteFromClipboardBehavior textBoxPasteFromClipboardBehavior
            textBoxTable:Add(textBoxControlV, textBoxPasteFromClipboardBehavior)

            //now do undo/redo
            InputSet textBoxControlZ
            textBoxControlZ:SetKeyboardInput(keys:Z)
            textBoxControlZ:AddModifier(textBoxControlZ:CONTROL)
            TextBoxUndoBehavior textBoxUndoBehavior
            textBoxTable:Add(textBoxControlZ, textBoxUndoBehavior)

            InputSet textBoxControlY
            textBoxControlY:SetKeyboardInput(keys:Y)
            textBoxControlY:AddModifier(textBoxControlY:CONTROL)
            TextBoxRedoBehavior textBoxRedoBehavior
            textBoxTable:Add(textBoxControlY, textBoxRedoBehavior)

            //Selection
            InputSet textBoxControlA
            textBoxControlA:SetKeyboardInput(keys:A)
            textBoxControlA:AddModifier(textBoxControlA:CONTROL)
            TextBoxSelectAllBehavior textBoxSelectAllBehavior
            textBoxTable:Add(textBoxControlA, textBoxSelectAllBehavior)

            InputSet textBoxControlHome
            textBoxControlHome:SetKeyboardInput(keys:HOME)
            textBoxControlHome:AddModifier(textBoxControlHome:CONTROL)
            TextBoxCaretToDocumentStartBehavior textBoxCaretToDocumentStartBehavior
            textBoxTable:Add(textBoxControlHome, textBoxCaretToDocumentStartBehavior)

            InputSet textBoxControlEnd
            textBoxControlEnd:SetKeyboardInput(keys:END)
            textBoxControlEnd:AddModifier(textBoxControlEnd:CONTROL)
            TextBoxCaretToDocumentEndBehavior textBoxCaretToDocumentEndBehavior
            textBoxTable:Add(textBoxControlEnd, textBoxCaretToDocumentEndBehavior)

            InputSet textBoxShiftControlHome
            textBoxShiftControlHome:SetKeyboardInput(keys:HOME)
            textBoxShiftControlHome:AddModifier(textBoxShiftControlHome:SHIFT)
            textBoxShiftControlHome:AddModifier(textBoxShiftControlHome:CONTROL)
            TextBoxSelectToDocumentStartBehavior textBoxSelectToDocumentStartBehavior
            textBoxTable:Add(textBoxShiftControlHome, textBoxSelectToDocumentStartBehavior)

            InputSet textBoxShiftControlEnd
            textBoxShiftControlEnd:SetKeyboardInput(keys:END)
            textBoxShiftControlEnd:AddModifier(textBoxShiftControlEnd:SHIFT)
            textBoxShiftControlEnd:AddModifier(textBoxShiftControlEnd:CONTROL)
            TextBoxSelectToDocumentEndBehavior textBoxSelectToDocumentEndBehavior
            textBoxTable:Add(textBoxShiftControlEnd, textBoxCaretToDocumentEndBehavior)

            InputSet textBoxControlRight
            textBoxControlRight:SetKeyboardInput(keys:RIGHT)
            textBoxControlRight:AddModifier(textBoxControlRight:CONTROL)
            TextBoxCaretToTokenEndBehavior textBoxCaretToTokenEndBehavior
            textBoxTable:Add(textBoxControlRight, textBoxCaretToTokenEndBehavior)

            InputSet textBoxControlLeft
            textBoxControlLeft:SetKeyboardInput(keys:LEFT)
            textBoxControlLeft:AddModifier(textBoxControlLeft:CONTROL)
            TextBoxCaretToTokenStartBehavior textBoxCaretToTokenStartBehavior
            textBoxTable:Add(textBoxControlLeft, textBoxCaretToTokenStartBehavior)
        end
        
        TextBoxCaretStartMoveBehavior textBoxLeftBehavior
        textBoxLeftBehavior:SetDirection(textBoxLeftBehavior:LEFT)
        textBoxTable:Add(GetLeftArrowKey(), textBoxLeftBehavior)

        TextBoxCaretStartMoveBehavior textBoxShiftLeftBehavior
        textBoxShiftLeftBehavior:SetSelecting(true)
        textBoxShiftLeftBehavior:SetDirection(textBoxShiftLeftBehavior:LEFT)
        textBoxTable:Add(AddShiftModifier(GetLeftArrowKey()), textBoxShiftLeftBehavior)

        TextBoxCaretStartMoveBehavior textBoxRightBehavior
        textBoxRightBehavior:SetDirection(textBoxRightBehavior:RIGHT)
        textBoxTable:Add(GetRightArrowKey(), textBoxRightBehavior)

        TextBoxCaretStartMoveBehavior textBoxShiftRightBehavior
        textBoxShiftRightBehavior:SetSelecting(true)
        textBoxShiftRightBehavior:SetDirection(textBoxShiftRightBehavior:RIGHT)
        textBoxTable:Add(AddShiftModifier(GetRightArrowKey()), textBoxShiftRightBehavior)

        TextBoxCaretStartMoveBehavior textBoxDownBehavior
        textBoxDownBehavior:SetDirection(textBoxDownBehavior:DOWN)
        textBoxTable:Add(GetDownArrowKey(), textBoxDownBehavior)

        TextBoxCaretStartMoveBehavior textBoxShiftDownBehavior
        textBoxShiftDownBehavior:SetSelecting(true)
        textBoxShiftDownBehavior:SetDirection(textBoxShiftDownBehavior:DOWN)
        textBoxTable:Add(AddShiftModifier(GetDownArrowKey()), textBoxShiftDownBehavior)

        TextBoxCaretStartMoveBehavior textBoxUpBehavior
        textBoxUpBehavior:SetDirection(textBoxUpBehavior:UP)
        textBoxTable:Add(GetUpArrowKey(), textBoxUpBehavior)

        TextBoxCaretStartMoveBehavior textBoxShiftUpBehavior
        textBoxShiftUpBehavior:SetSelecting(true)
        textBoxShiftUpBehavior:SetDirection(textBoxShiftUpBehavior:UP)
        textBoxTable:Add(AddShiftModifier(GetUpArrowKey()), textBoxShiftUpBehavior)

        CancelBehavior cancelBehavior

        InputSet releaseLeftArrow
        releaseLeftArrow:SetKeyboardInput(keys:LEFT)
        releaseLeftArrow:SetInputTrigger(releaseLeftArrow:FINISH)
        textBoxTable:Add(releaseLeftArrow, cancelBehavior)

        InputSet releaseShiftLeftArrow
        releaseShiftLeftArrow:SetKeyboardInput(keys:LEFT)
        releaseShiftLeftArrow:AddModifier(releaseShiftLeftArrow:SHIFT)
        releaseShiftLeftArrow:SetInputTrigger(releaseShiftLeftArrow:FINISH)
        textBoxTable:Add(releaseShiftLeftArrow, cancelBehavior)

        InputSet releaseRightArrow
        releaseRightArrow:SetKeyboardInput(keys:RIGHT)
        releaseRightArrow:SetInputTrigger(releaseRightArrow:FINISH)
        textBoxTable:Add(releaseRightArrow, cancelBehavior)

        InputSet releaseShiftRightArrow
        releaseShiftRightArrow:SetKeyboardInput(keys:RIGHT)
        releaseShiftRightArrow:AddModifier(releaseShiftRightArrow:SHIFT)
        releaseShiftRightArrow:SetInputTrigger(releaseShiftRightArrow:FINISH)
        textBoxTable:Add(releaseShiftRightArrow, cancelBehavior)

        InputSet releaseDownArrow
        releaseDownArrow:SetKeyboardInput(keys:DOWN)
        releaseDownArrow:SetInputTrigger(releaseDownArrow:FINISH)
        textBoxTable:Add(releaseDownArrow, cancelBehavior)

        InputSet releaseShiftDownArrow
        releaseShiftDownArrow:SetKeyboardInput(keys:DOWN)
        releaseShiftDownArrow:AddModifier(releaseShiftDownArrow:SHIFT)
        releaseShiftDownArrow:SetInputTrigger(releaseShiftDownArrow:FINISH)
        textBoxTable:Add(releaseShiftDownArrow, cancelBehavior)

        InputSet releaseUpArrow
        releaseUpArrow:SetKeyboardInput(keys:UP)
        releaseUpArrow:SetInputTrigger(releaseUpArrow:FINISH)
        textBoxTable:Add(releaseUpArrow, cancelBehavior)

        InputSet releaseShiftUpArrow
        releaseShiftUpArrow:SetKeyboardInput(keys:UP)
        releaseShiftUpArrow:AddModifier(releaseShiftUpArrow:SHIFT)
        releaseShiftUpArrow:SetInputTrigger(releaseShiftUpArrow:FINISH)
        textBoxTable:Add(releaseShiftUpArrow, cancelBehavior)

        InputSet backspace
        backspace:SetKeyboardInput(keys:BACKSPACE)
        TextBoxStartDeleteBehavior backDeleteBehavior
        backDeleteBehavior:SetDirection(backDeleteBehavior:BACKWARD)
        textBoxTable:Add(backspace, backDeleteBehavior)

        InputSet delete
        delete:SetKeyboardInput(keys:FORWARD_DELETE)
        TextBoxStartDeleteBehavior forwardDeleteBehavior
        forwardDeleteBehavior:SetDirection(forwardDeleteBehavior:FORWARD)
        textBoxTable:Add(delete, forwardDeleteBehavior)

        InputSet releaseBackspace
        releaseBackspace:SetKeyboardInput(keys:BACKSPACE)
        releaseBackspace:SetInputTrigger(releaseBackspace:FINISH)
        textBoxTable:Add(releaseBackspace, cancelBehavior)

        InputSet releaseDelete
        releaseDelete:SetKeyboardInput(keys:FORWARD_DELETE)
        releaseDelete:SetInputTrigger(releaseDelete:FINISH)
        textBoxTable:Add(releaseDelete, cancelBehavior)

        InputSet enter
        enter:SetKeyboardInput(keys:ENTER)
        TextBoxStartNewLineBehavior newLineBehavior
        textBoxTable:Add(enter, newLineBehavior)
        textBoxTable:Add(numpadEnter, newLineBehavior)

        InputSet enter2
        enter2:SetKeyboardInput(keys:ENTER)
        enter2:AddModifier(enter2:SHIFT)
        TextBoxStartNewLineBehavior newLineBehavior2
        textBoxTable:Add(enter2, newLineBehavior2)
        textBoxTable:Add(numpadEnter, newLineBehavior2)

        InputSet releaseEnter
        releaseEnter:SetKeyboardInput(keys:ENTER)
        releaseEnter:SetInputTrigger(releaseEnter:FINISH)
        textBoxTable:Add(releaseEnter, cancelBehavior)

        InputSet releaseEnter2
        releaseEnter2:SetKeyboardInput(keys:ENTER)
        releaseEnter2:AddModifier(releaseEnter2:SHIFT)
        releaseEnter2:SetInputTrigger(releaseEnter2:FINISH)
        textBoxTable:Add(releaseEnter2, cancelBehavior)

        InputSet releaseNumpadEnter
        releaseNumpadEnter:SetKeyboardInput(keys:NUMPAD_ENTER)
        releaseNumpadEnter:SetInputTrigger(releaseNumpadEnter:FINISH)
        textBoxTable:Add(releaseNumpadEnter, cancelBehavior)

        InputSet textInputSet
        textInputSet:SetInputType(textInputSet:TEXT_INPUT)
        TextBoxInsertBehavior insertBehavior
        textBoxTable:Add(textInputSet, insertBehavior)

        InputSet tabSet
        tabSet:SetKeyboardInput(keys:TAB)
        TextBoxAddIndentationBehavior addIndentBehavior
        textBoxTable:Add(tabSet, addIndentBehavior)

        InputSet shiftTabSet
        shiftTabSet:SetKeyboardInput(keys:TAB)
        shiftTabSet:AddModifier(shiftTabSet:SHIFT)
        TextBoxRemoveIndentationBehavior removeIndentBehavior
        textBoxTable:Add(shiftTabSet, removeIndentBehavior)

        InputSet touchSet
        touchSet:SetInputType(touchSet:TOUCH_INPUT)
        TextBoxOpenKeyboardBehavior openKeyboardBehavior
        textBoxTable:Add(touchSet, openKeyboardBehavior)

        InputSet homeSet
        homeSet:SetKeyboardInput(keys:HOME)
        TextBoxCaretToLineStartBehavior caretLineStartBehavior
        textBoxTable:Add(homeSet, caretLineStartBehavior)

        InputSet shiftHomeSet
        shiftHomeSet:SetKeyboardInput(keys:HOME)
        shiftHomeSet:AddModifier(shiftHomeSet:SHIFT)
        TextBoxSelectToLineStartBehavior selectLineStartBehavior
        textBoxTable:Add(shiftHomeSet, selectLineStartBehavior)

        InputSet shiftEndSet
        shiftEndSet:SetKeyboardInput(keys:END)
        shiftEndSet:AddModifier(shiftHomeSet:SHIFT)
        TextBoxSelectToLineEndBehavior selectLineEndBehavior
        textBoxTable:Add(shiftEndSet, selectLineEndBehavior)

        InputSet shiftF10SetTextBox
        shiftF10SetTextBox:SetKeyboardInput(keys:F10)
        shiftF10SetTextBox:AddModifier(shiftF10SetTextBox:SHIFT)
        TextBoxOpenPopupMenuBehavior textBoxOpenPopupMenuBehavior
        textBoxTable:Add(shiftF10SetTextBox, textBoxOpenPopupMenuBehavior)

        InputSet rightClickSetTextBox
        rightClickSetTextBox:SetMouseInput(mouse:RIGHT)
        textBoxTable:Add(rightClickSetTextBox, textBoxOpenPopupMenuBehavior)

        InputSet rightClickControlSet
        rightClickControlSet:SetMouseInput(mouse:LEFT)
        rightClickControlSet:AddModifier(rightClickControlSet:CONTROL)

        if manager:GetOperatingSystem():Contains("OS X")
            textBoxTable:Add(rightClickControlSet, textBoxOpenPopupMenuBehavior)
        end

        Behavior emptyBehavior
        textBoxTable:Add(GetLeftClick(), emptyBehavior)

        InputSet clickSet
        clickSet:SetMouseInput(mouse:LEFT)
        TextBoxClickBehavior clickBehavior
        textBoxTable:Add(clickSet, clickBehavior)

        InputSet clickEndSet
        clickEndSet:SetMouseInput(mouse:LEFT)
        clickEndSet:SetInputTrigger(clickEndSet:FINISH)
        TextBoxClickEndBehavior clickEndBehavior
        textBoxTable:Add(clickEndSet, clickEndBehavior)

        InputSet doubleClick
        doubleClick:SetMouseInput(mouse:LEFT)
        doubleClick:SetEventCount(2)
        TextBoxDoubleClickSelectWordBehavior textBoxDoubleClickSelectWordBehavior
        textBoxTable:Add(doubleClick, textBoxDoubleClickSelectWordBehavior)

        InputSet shiftLeft
        shiftLeft:SetKeyboardInput(keys:SHIFT_LEFT)
        TextBoxSavePreviousCaretPositionBehavior textBoxSavePreviousCaretPositionBehavior
        textBoxTable:Add(shiftLeft, textBoxSavePreviousCaretPositionBehavior)

        InputSet shiftRight
        shiftRight:SetKeyboardInput(keys:SHIFT_RIGHT)
        textBoxTable:Add(shiftRight, textBoxSavePreviousCaretPositionBehavior)

        InputSet shiftMouseClick
        shiftMouseClick:SetMouseInput(mouse:CLICKED_MOUSE)
        shiftMouseClick:AddModifier(shiftMouseClick:SHIFT)
        TextBoxSelectToMouseClickBehavior textBoxSelectToMouseClickBehavior
        textBoxTable:Add(shiftMouseClick, textBoxSelectToMouseClickBehavior)

        InputSet pageDown
        pageDown:SetKeyboardInput(keys:PAGE_DOWN)
        TextBoxPageDownBehavior textBoxPageDownBehavior
        textBoxTable:Add(pageDown, textBoxPageDownBehavior)

        InputSet pageUp
        pageUp:SetKeyboardInput(keys:PAGE_UP)
        TextBoxPageUpBehavior textBoxPageUpBehavior
        textBoxTable:Add(pageUp, textBoxPageUpBehavior)
               
        if manager:GetOperatingSystem():Contains("OS X")
            //first do copy paste
            InputSet textBoxSelectLeft
            textBoxSelectLeft:SetKeyboardInput(keys:LEFT)
            textBoxSelectLeft:AddModifier(textBoxSelectLeft:ALT)
            textBoxSelectLeft:AddModifier(textBoxSelectLeft:SHIFT)
            TextBoxSelectToTokenStartBehavior textBoxSelectToTokenStartBehavior
            textBoxTable:Add(textBoxSelectLeft, textBoxSelectToTokenStartBehavior)

            InputSet textBoxSelectRight
            textBoxSelectRight:SetKeyboardInput(keys:RIGHT)
            textBoxSelectRight:AddModifier(textBoxSelectLeft:ALT)
            textBoxSelectRight:AddModifier(textBoxSelectLeft:SHIFT)
            TextBoxSelectToTokenEndBehavior textBoxSelectToTokenEndBehavior
            textBoxTable:Add(textBoxSelectRight, textBoxSelectToTokenEndBehavior)
        else
            InputSet textBoxSelectLeft
            textBoxSelectLeft:SetKeyboardInput(keys:LEFT)
            textBoxSelectLeft:AddModifier(textBoxSelectLeft:CONTROL)
            textBoxSelectLeft:AddModifier(textBoxSelectLeft:SHIFT)
            TextBoxSelectToTokenStartBehavior textBoxSelectToTokenStartBehavior
            textBoxTable:Add(textBoxSelectLeft, textBoxSelectToTokenStartBehavior)

            InputSet textBoxSelectRight
            textBoxSelectRight:SetKeyboardInput(keys:RIGHT)
            textBoxSelectRight:AddModifier(textBoxSelectLeft:CONTROL)
            textBoxSelectRight:AddModifier(textBoxSelectLeft:SHIFT)
            TextBoxSelectToTokenEndBehavior textBoxSelectToTokenEndBehavior
            textBoxTable:Add(textBoxSelectRight, textBoxSelectToTokenEndBehavior)
        end

        InputSet endSet
        endSet:SetKeyboardInput(keys:END)
        TextBoxCaretToLineEndBehavior caretLineEndBehavior
        textBoxTable:Add(endSet, caretLineEndBehavior)

        if manager:GetOperatingSystem():Contains("OS X")
            textBoxTable:Add(AddMetaModifier(GetLeftArrowKey()), caretLineStartBehavior)
            textBoxTable:Add(AddMetaModifier(GetRightArrowKey()), caretLineEndBehavior)

            textBoxTable:Add(AddShiftModifier(AddMetaModifier(GetLeftArrowKey())), selectLineStartBehavior)
            textBoxTable:Add(AddShiftModifier(AddMetaModifier(GetRightArrowKey())), selectLineEndBehavior)
        end

        InputSet mouseScrollSet
        mouseScrollSet:SetInputType(mouseScrollSet:MOUSE_WHEEL_INPUT)
        ScrollableControlMouseScrollBehavior scrollBehavior
        textBoxTable:Add(mouseScrollSet, scrollBehavior)

        gameInput:AddInputTable(textBoxTable)
    end

    action SetupTextFieldInput(GameInput gameInput)
        InputTable textFieldTable
        textFieldTable:SetIdentifier("TextField")

        TextFieldCaretStartMoveBehavior textFieldLeftBehavior
        textFieldLeftBehavior:SetDirection(textFieldLeftBehavior:LEFT)
        textFieldTable:Add(GetLeftArrowKey(), textFieldLeftBehavior)

        TextFieldCaretStartMoveBehavior textFieldShiftLeftBehavior
        textFieldShiftLeftBehavior:SetSelecting(true)
        textFieldShiftLeftBehavior:SetDirection(textFieldShiftLeftBehavior:LEFT)
        
        textFieldTable:Add(AddShiftModifier(GetLeftArrowKey()), textFieldShiftLeftBehavior)

        TextFieldCaretToStartBehavior textFieldUpBehavior
        textFieldTable:Add(GetUpArrowKey(), textFieldUpBehavior)

        TextFieldSelectToStartBehavior textFieldShiftUpBehavior
        textFieldTable:Add(AddShiftModifier(GetUpArrowKey()), textFieldShiftUpBehavior)

        TextFieldCaretToEndBehavior textFieldDownBehavior
        textFieldTable:Add(GetDownArrowKey(), textFieldDownBehavior)

        TextFieldSelectToEndBehavior textFieldShiftDownBehavior
        textFieldTable:Add(AddShiftModifier(GetDownArrowKey()), textFieldShiftDownBehavior)
        
        TextFieldCaretStartMoveBehavior textFieldRightBehavior
        textFieldRightBehavior:SetDirection(textFieldRightBehavior:RIGHT)
        textFieldTable:Add(GetRightArrowKey(), textFieldRightBehavior)

        TextFieldCaretStartMoveBehavior textFieldShiftRightBehavior
        textFieldShiftRightBehavior:SetSelecting(true)
        textFieldShiftRightBehavior:SetDirection(textFieldShiftRightBehavior:RIGHT)
        textFieldTable:Add(AddShiftModifier(GetRightArrowKey()), textFieldShiftRightBehavior)

        CancelBehavior cancelBehavior

        InputSet releaseLeftArrow
        releaseLeftArrow = GetLeftArrowKey()
        releaseLeftArrow:SetInputTrigger(releaseLeftArrow:FINISH)

        InputSet releaseShiftLeftArrow
        releaseShiftLeftArrow = AddShiftModifier(GetLeftArrowKey())
        releaseShiftLeftArrow:SetInputTrigger(releaseLeftArrow:FINISH)

        InputSet releaseRightArrow
        releaseRightArrow = GetRightArrowKey()
        releaseRightArrow:SetInputTrigger(releaseRightArrow:FINISH)

        InputSet releaseShiftRightArrow
        releaseShiftRightArrow = AddShiftModifier(GetRightArrowKey())
        releaseShiftRightArrow:SetInputTrigger(releaseShiftRightArrow:FINISH)

        textFieldTable:Add(releaseLeftArrow, cancelBehavior)
        textFieldTable:Add(releaseShiftLeftArrow, cancelBehavior)
        textFieldTable:Add(releaseRightArrow, cancelBehavior)
        textFieldTable:Add(releaseShiftRightArrow, cancelBehavior)

        InputSet backspace
        backspace:SetKeyboardInput(keys:BACKSPACE)

        InputSet releaseBackspace
        releaseBackspace:SetKeyboardInput(keys:BACKSPACE)
        releaseBackspace:SetInputTrigger(releaseBackspace:FINISH)

        InputSet delete
        delete:SetKeyboardInput(keys:FORWARD_DELETE)

        InputSet releaseDelete
        releaseDelete:SetKeyboardInput(keys:FORWARD_DELETE)
        releaseDelete:SetInputTrigger(releaseDelete:FINISH)

        TextFieldStartDeleteBehavior fieldBackDeleteBehavior
        fieldBackDeleteBehavior:SetDirection(fieldBackDeleteBehavior:BACKWARD)
        textFieldTable:Add(backspace, fieldBackDeleteBehavior)

        TextFieldStartDeleteBehavior fieldForwardDeleteBehavior
        fieldForwardDeleteBehavior:SetDirection(fieldForwardDeleteBehavior:FORWARD)
        textFieldTable:Add(delete, fieldForwardDeleteBehavior)

        textFieldTable:Add(releaseBackspace, cancelBehavior)
        textFieldTable:Add(releaseDelete, cancelBehavior)

        TextFieldInsertBehavior fieldInsertBehavior
        textFieldTable:Add(GetTextInputSet(), fieldInsertBehavior)

        InputSet doubleClick
        doubleClick:SetMouseInput(mouse:LEFT)
        doubleClick:SetEventCount(2)

        InputSet tripleClick
        tripleClick:SetMouseInput(mouse:LEFT)
        tripleClick:SetEventCount(3)

        InputSet homeSet
        homeSet:SetKeyboardInput(keys:HOME)

        InputSet shiftHomeSet
        shiftHomeSet:SetKeyboardInput(keys:HOME)
        shiftHomeSet = AddShiftModifier(shiftHomeSet)

        InputSet endSet
        endSet:SetKeyboardInput(keys:END)

        InputSet shiftEndSet
        shiftEndSet:SetKeyboardInput(keys:END)
        shiftEndSet = AddShiftModifier(shiftEndSet)

        Behavior emptyBehavior
        textFieldTable:Add(GetLeftClick(), emptyBehavior)

        TextFieldDoubleClickSelectWordBehavior textFieldDoubleClickSelectWordBehavior
        textFieldTable:Add(doubleClick, textFieldDoubleClickSelectWordBehavior) 

        TextFieldCaretToStartBehavior textFieldCaretToStartBehavior
        textFieldTable:Add(homeSet, textFieldCaretToStartBehavior)

        TextFieldCaretToEndBehavior textFieldCaretToEndBehavior
        textFieldTable:Add(endSet, textFieldCaretToEndBehavior)

        TextFieldSelectToStartBehavior textFieldSelectToStartBehavior
        textFieldTable:Add(shiftHomeSet, textFieldSelectToStartBehavior)

        TextFieldSelectToEndBehavior textFieldSelectToEndBehavior
        textFieldTable:Add(shiftEndSet, textFieldSelectToEndBehavior)


        TextFieldSelectAllBehavior textFieldSelectAllBehavior
        textFieldTable:Add(tripleClick, textFieldSelectAllBehavior)

        InputSet shiftMouseClick
        shiftMouseClick:SetMouseInput(mouse:CLICKED_MOUSE)
        shiftMouseClick:AddModifier(shiftMouseClick:SHIFT)

        TextFieldSelectToMouseClickBehavior textFieldSelectToMouseClickBehavior
        textFieldTable:Add(shiftMouseClick, textFieldSelectToMouseClickBehavior)

        //copy past for fields
        if manager:GetOperatingSystem():Contains("OS X")
            //first do copy paste
            InputSet textFieldControlC
            textFieldControlC:SetKeyboardInput(keys:C)
            textFieldControlC:AddModifier(textFieldControlC:META)
            TextFieldCopyToClipboardBehavior textFieldCopyToClipboardBehavior
            textFieldTable:Add(textFieldControlC, textFieldCopyToClipboardBehavior)

            InputSet textFieldControlX
            textFieldControlX:SetKeyboardInput(keys:X)
            textFieldControlX:AddModifier(textFieldControlX:META)
            TextFieldCutToClipboardBehavior textFieldCutToClipboardBehavior
            textFieldTable:Add(textFieldControlX, textFieldCutToClipboardBehavior)

            InputSet textFieldControlV
            textFieldControlV:SetKeyboardInput(keys:V)
            textFieldControlV:AddModifier(textFieldControlV:META)
            TextFieldPasteFromClipboardBehavior textFieldPasteFromClipboardBehavior
            textFieldTable:Add(textFieldControlV, textFieldPasteFromClipboardBehavior)

            //Selection
            InputSet textFieldControlA
            textFieldControlA:SetKeyboardInput(keys:A)
            textFieldControlA:AddModifier(textFieldControlA:META)
            textFieldTable:Add(textFieldControlA, textFieldSelectAllBehavior)

            InputSet textFieldAltRight
            textFieldAltRight:SetKeyboardInput(keys:RIGHT)
            textFieldAltRight:AddModifier(textFieldAltRight:ALT)
            TextFieldCaretToTokenEndBehavior textFieldCaretToTokenEndBehavior
            textFieldTable:Add(textFieldAltRight, textFieldCaretToTokenEndBehavior)

            InputSet textFieldAltLeft
            textFieldAltLeft:SetKeyboardInput(keys:LEFT)
            textFieldAltLeft:AddModifier(textFieldAltLeft:ALT)
            TextFieldCaretToTokenStartBehavior textFieldCaretToTokenStartBehavior
            textFieldTable:Add(textFieldAltLeft, textFieldCaretToTokenStartBehavior)

            InputSet textFieldSelectAltRight
            textFieldSelectAltRight:SetKeyboardInput(keys:RIGHT)
            textFieldSelectAltRight:AddModifier(textFieldSelectAltRight:ALT)
            textFieldSelectAltRight:AddModifier(textFieldSelectAltRight:SHIFT)
            TextFieldSelectTokenEndBehavior textFieldSelectTokenEndBehavior
            textFieldTable:Add(textFieldSelectAltRight, textFieldSelectTokenEndBehavior)

            InputSet textFieldSelectAltLeft
            textFieldSelectAltLeft:SetKeyboardInput(keys:LEFT)
            textFieldSelectAltLeft:AddModifier(textFieldSelectAltLeft:ALT)
            textFieldSelectAltLeft:AddModifier(textFieldSelectAltLeft:SHIFT)
            TextFieldSelectTokenStartBehavior textFieldSelectTokenStartBehavior
            textFieldTable:Add(textFieldSelectAltLeft, textFieldSelectTokenStartBehavior)
        else
            InputSet textFieldControlC
            textFieldControlC:SetKeyboardInput(keys:C)
            textFieldControlC:AddModifier(textFieldControlC:CONTROL)
            TextFieldCopyToClipboardBehavior textFieldCopyToClipboardBehavior
            textFieldTable:Add(textFieldControlC, textFieldCopyToClipboardBehavior)

            InputSet textFieldControlX
            textFieldControlX:SetKeyboardInput(keys:X)
            textFieldControlX:AddModifier(textFieldControlX:CONTROL)
            TextFieldCutToClipboardBehavior textFieldCutToClipboardBehavior
            textFieldTable:Add(textFieldControlX, textFieldCutToClipboardBehavior)

            InputSet textFieldControlV
            textFieldControlV:SetKeyboardInput(keys:V)
            textFieldControlV:AddModifier(textFieldControlV:CONTROL)
            TextFieldPasteFromClipboardBehavior textFieldPasteFromClipboardBehavior
            textFieldTable:Add(textFieldControlV, textFieldPasteFromClipboardBehavior)

            //Selection
            InputSet textFieldControlA
            textFieldControlA:SetKeyboardInput(keys:A)
            textFieldControlA:AddModifier(textFieldControlA:CONTROL)
            textFieldTable:Add(textFieldControlA, textFieldSelectAllBehavior)


            InputSet textFieldCtrlRight
            textFieldCtrlRight:SetKeyboardInput(keys:RIGHT)
            textFieldCtrlRight:AddModifier(textFieldCtrlRight:CONTROL)
            TextFieldCaretToTokenEndBehavior textFieldCaretToTokenEndBehavior
            textFieldTable:Add(textFieldCtrlRight, textFieldCaretToTokenEndBehavior)

            InputSet textFieldCtrlLeft
            textFieldCtrlLeft:SetKeyboardInput(keys:LEFT)
            textFieldCtrlLeft:AddModifier(textFieldCtrlLeft:CONTROL)
            TextFieldCaretToTokenStartBehavior textFieldCaretToTokenStartBehavior
            textFieldTable:Add(textFieldCtrlLeft, textFieldCaretToTokenStartBehavior)

            InputSet textFieldSelectCtrlRight
            textFieldSelectCtrlRight:SetKeyboardInput(keys:RIGHT)
            textFieldSelectCtrlRight:AddModifier(textFieldSelectCtrlRight:CONTROL)
            textFieldSelectCtrlRight:AddModifier(textFieldSelectCtrlRight:SHIFT)
            TextFieldSelectTokenEndBehavior textFieldSelectTokenEndBehavior
            textFieldTable:Add(textFieldSelectCtrlRight, textFieldSelectTokenEndBehavior)

            InputSet textFieldSelectCtrlLeft
            textFieldSelectCtrlLeft:SetKeyboardInput(keys:LEFT)
            textFieldSelectCtrlLeft:AddModifier(textFieldSelectCtrlLeft:CONTROL)
            textFieldSelectCtrlLeft:AddModifier(textFieldSelectCtrlLeft:SHIFT)
            TextFieldSelectTokenStartBehavior textFieldSelectTokenStartBehavior
            textFieldTable:Add(textFieldSelectCtrlLeft, textFieldSelectTokenStartBehavior)
        end
        gameInput:AddInputTable(textFieldTable)
    end

    action SetupSceneEditorInput(GameInput gameInput)
        SceneEditorInputTable table
        table:SetIdentifier("SceneEditor")
        InputTable selectionTable
        selectionTable:SetIdentifier("SelectionHighlight3D")
        InputTable selectionTable2D
        selectionTable2D:SetIdentifier("SelectionHighlight2D")
        InputTable cameraItemTable2D
        cameraItemTable2D:SetIdentifier("CameraItem2D")
        InputTable cameraItemTable3D
        cameraItemTable3D:SetIdentifier("CameraItem3D")
        InputTable itemPreviewTable
        itemPreviewTable:SetIdentifier("NewItemPreview3D")
        InputTable itemPreviewTable2D
        itemPreviewTable2D:SetIdentifier("NewItemPreview2D")
        InputTable propertiesDialogTable
        propertiesDialogTable:SetIdentifier("PropertiesDialog")
        InputTable findTable
        findTable:SetIdentifier("VisualEditorFindDialog")
        InputTable paletteItemContentTable
        paletteItemContentTable:SetIdentifier("PaletteItemContent")

        //Selection behaviors
        SelectionXDirectionBehavior selectionStartMovingLeftBehavior
        SelectionXDirectionBehavior selectionStartMovingRightBehavior
        SelectionXDirectionBehavior selectionStopMovingXBehavior
        SelectionYDirectionBehavior selectionStartMovingUpBehavior
        SelectionYDirectionBehavior selectionStartMovingDownBehavior
        SelectionYDirectionBehavior selectionStopMovingYBehavior
        SelectionZDirectionBehavior selectionStartMovingForwardBehavior
        SelectionZDirectionBehavior selectionStartMovingBackwardBehavior
        SelectionZDirectionBehavior selectionStopMovingZBehavior
        SelectionYawDirectionBehavior selectionStartRotatingYawLeftBehavior
        SelectionYawDirectionBehavior selectionStartRotatingYawRightBehavior
        SelectionYawDirectionBehavior selectionStopRotatingYawBehavior
        SelectionPitchDirectionBehavior selectionStartRotatingPitchUpBehavior
        SelectionPitchDirectionBehavior selectionStartRotatingPitchDownBehavior
        SelectionPitchDirectionBehavior selectionStopRotatingPitchBehavior
        SelectionRollDirectionBehavior selectionStartRotatingRollLeftBehavior
        SelectionRollDirectionBehavior selectionStartRotatingRollRightBehavior
        SelectionRollDirectionBehavior selectionStopRotatingRollBehavior
        SelectionScaleBehavior selectionScaleUpBehavior
        SelectionScaleBehavior selectionScaleDownBehavior
        SelectionScaleBehavior selectionScaleXUpBehavior
        SelectionScaleBehavior selectionScaleXDownBehavior
        SelectionScaleBehavior selectionScaleYUpBehavior
        SelectionScaleBehavior selectionScaleYDownBehavior
        SelectionScaleBehavior selectionScaleZUpBehavior
        SelectionScaleBehavior selectionScaleZDownBehavior
        SelectionDeleteBehavior selectionDeleteBehavior
        SelectionCancelBehavior selectionCancelBehavior
        SelectionResetScaleBehavior selectionResetScaleBehavior
        SelectSceneItemBehavior selectSceneItemBehavior
        SelectionHighlightDragBehavior selectionHighlightDragBehavior

        selectionStartMovingLeftBehavior:SetDirection(-1)
        selectionStartMovingRightBehavior:SetDirection(1)
        selectionStopMovingXBehavior:SetDirection(0)
        selectionStartMovingUpBehavior:SetDirection(1)
        selectionStartMovingDownBehavior:SetDirection(-1)
        selectionStopMovingYBehavior:SetDirection(0)
        selectionStartMovingForwardBehavior:SetDirection(1)
        selectionStartMovingBackwardBehavior:SetDirection(-1)
        selectionStopMovingZBehavior:SetDirection(0)
        selectionStartRotatingYawLeftBehavior:SetDirection(-1)
        selectionStartRotatingYawRightBehavior:SetDirection(1)
        selectionStopRotatingYawBehavior:SetDirection(0)
        selectionStartRotatingPitchUpBehavior:SetDirection(-1)
        selectionStartRotatingPitchDownBehavior:SetDirection(1)
        selectionStopRotatingPitchBehavior:SetDirection(0)
        selectionStartRotatingRollLeftBehavior:SetDirection(1)
        selectionStartRotatingRollRightBehavior:SetDirection(-1)
        selectionStopRotatingRollBehavior:SetDirection(0)
        selectionScaleUpBehavior:SetScale(1.1, 1.1, 1.1)
        selectionScaleDownBehavior:SetScale(1.0/1.1, 1.0/1.1, 1.0/1.1)
        selectionScaleXUpBehavior:SetScale(1.1, 1, 1)
        selectionScaleXDownBehavior:SetScale(1.0/1.1, 1, 1)
        selectionScaleYUpBehavior:SetScale(1, 1.1, 1)
        selectionScaleYDownBehavior:SetScale(1, 1.0/1.1, 1)
        selectionScaleZUpBehavior:SetScale(1, 1, 1.1)
        selectionScaleZDownBehavior:SetScale(1, 1, 1.0/1.1)

        // camera behaviors
        CameraYawRotationBehavior cameraStartRotateLeftBehavior
        CameraYawRotationBehavior cameraStartRotateRightBehavior
        CameraYawRotationBehavior cameraStopYawRotationBehavior
        CameraPitchRotationBehavior cameraStartRotateUpBehavior
        CameraPitchRotationBehavior cameraStartRotateDownBehavior
        CameraPitchRotationBehavior cameraStopPitchRotationBehavior
        CameraMoveDirectionBehavior cameraStartMoveForwardBehavior
        CameraMoveDirectionBehavior cameraStartMoveBackwardBehavior
        CameraMoveDirectionBehavior cameraStopMoveDirectionBehavior
        CameraStrafeDirectionBehavior cameraStartStrafeLeftBehavior
        CameraStrafeDirectionBehavior cameraStartStrafeRightBehavior
        CameraStrafeDirectionBehavior cameraStopStrafeDirectionBehavior
        CameraVerticalDirectionBehavior cameraStartMoveUpBehavior
        CameraVerticalDirectionBehavior cameraStartMoveDownBehavior
        CameraVerticalDirectionBehavior cameraStopVerticalDirectionBehavior
        CameraItemsInViewBehavior cameraItemsInViewBehavior

        cameraStartRotateLeftBehavior:SetDirection(-1)
        cameraStartRotateRightBehavior:SetDirection(1)
        cameraStopYawRotationBehavior:SetDirection(0)
        cameraStartRotateUpBehavior:SetDirection(1)
        cameraStartRotateDownBehavior:SetDirection(-1)
        cameraStopPitchRotationBehavior:SetDirection(0)
        cameraStartMoveForwardBehavior:SetDirection(1)
        cameraStartMoveBackwardBehavior:SetDirection(-1)
        cameraStopMoveDirectionBehavior:SetDirection(0)
        cameraStartStrafeLeftBehavior:SetDirection(1)
        cameraStartStrafeRightBehavior:SetDirection(-1)
        cameraStopStrafeDirectionBehavior:SetDirection(0)
        cameraStartMoveUpBehavior:SetDirection(1)
        cameraStartMoveDownBehavior:SetDirection(-1)
        cameraStopVerticalDirectionBehavior:SetDirection(0)

        // other behaviors
        FocusCameraBehavior focusCameraBehavior
        ItemCancelBehavior itemCancelBehavior
        ItemConfirmBehavior itemConfirmBehavior
        ReportLocationBehavior reportLocationBehavior
        ReportCameraDirectionBehavior reportCameraDirectionBehavior
        ReportItemsInViewBehavior reportItemsInViewBehavior
        ToggleGridBehavior toggleGridBehavior
        IncreaseGridUnitBehavior increaseGridUnitBehavior
        DecreaseGridUnitBehavior decreaseGridUnitBehavior
        FocusPropertiesBehavior focusPropertiesBehavior
        UnfocusPropertiesBehavior unfocusPropertiesBehavior
        OpenSceneEditorFindDialogBehavior openFindDialogBehavior
        CloseSceneEditorFindDialogBehavior closeFindDialogBehavior
        CursorSelectItemsBehavior cursorSelectItemsBehavior
        CursorIncreaseSizeBehavior cursorIncreaseSizeBehavior
        CursorDecreaseSizeBehavior cursorDecreaseSizeBehavior

        InputSet reportLocation
        reportLocation:SetKeyboardInput(keys:NUM_1)
        reportLocation:AddModifier(reportLocation:CONTROL)
        reportLocation:AddModifier(reportLocation:SHIFT)
        InputSet reportCameraDirection
        reportCameraDirection:SetKeyboardInput(keys:NUM_2)
        reportCameraDirection:AddModifier(reportCameraDirection:CONTROL)
        reportCameraDirection:AddModifier(reportCameraDirection:SHIFT)
        InputSet reportItemsInView
        reportItemsInView:SetKeyboardInput(keys:NUM_3)
        reportItemsInView:AddModifier(reportItemsInView:CONTROL)
        reportItemsInView:AddModifier(reportItemsInView:SHIFT)

        table:Add(reportLocation, reportLocationBehavior)
        table:Add(reportCameraDirection, reportCameraDirectionBehavior)
        table:Add(reportItemsInView, reportItemsInViewBehavior)

        InputSet selectionMoveLeft3DStart = GetLeftArrowKey()
        InputSet selectionMoveLeft3DStop = GetLeftArrowKey()
        selectionMoveLeft3DStop:SetInputTrigger(selectionMoveLeft3DStop:FINISH)
        InputSet selectionMoveRight3DStart = GetRightArrowKey()
        InputSet selectionMoveRight3DStop = GetRightArrowKey()
        selectionMoveRight3DStop:SetInputTrigger(selectionMoveRight3DStop:FINISH)

        InputSet selectionMoveUp3DStart
        InputSet selectionMoveUp3DStop
        InputSet selectionMoveDown3DStart
        InputSet selectionMoveDown3DStop

        if manager:GetOperatingSystem():Contains("OS X")
            selectionMoveUp3DStart = AddMetaModifier(GetUpArrowKey())
            selectionMoveUp3DStop = AddMetaModifier(GetUpArrowKey())
            selectionMoveUp3DStop:SetInputTrigger(selectionMoveUp3DStop:FINISH)
            selectionMoveDown3DStart = AddMetaModifier(GetDownArrowKey())
            selectionMoveDown3DStop = AddMetaModifier(GetDownArrowKey())
            selectionMoveDown3DStop:SetInputTrigger(selectionMoveDown3DStop:FINISH)
        else
            selectionMoveUp3DStart = AddControlModifier(GetUpArrowKey())
            selectionMoveUp3DStop = AddControlModifier(GetUpArrowKey())
            selectionMoveUp3DStop:SetInputTrigger(selectionMoveUp3DStop:FINISH)
            selectionMoveDown3DStart = AddControlModifier(GetDownArrowKey())
            selectionMoveDown3DStop = AddControlModifier(GetDownArrowKey())
            selectionMoveDown3DStop:SetInputTrigger(selectionMoveDown3DStop:FINISH)
        end

        InputSet selectionMoveForward3DStart = GetUpArrowKey()
        InputSet selectionMoveForward3DStop = GetUpArrowKey()
        selectionMoveForward3DStop:SetInputTrigger(selectionMoveForward3DStop:FINISH)
        InputSet selectionMoveBackward3DStart = GetDownArrowKey()
        InputSet selectionMoveBackward3DStop = GetDownArrowKey()
        selectionMoveBackward3DStop:SetInputTrigger(selectionMoveBackward3DStop:FINISH)

        // move 3D selection in x direction
        table:Add3D(selectionMoveLeft3DStart, selectionStartMovingLeftBehavior)
        table:Add3D(selectionMoveLeft3DStop, selectionStopMovingXBehavior)
        table:Add3D(selectionMoveRight3DStart, selectionStartMovingRightBehavior)
        table:Add3D(selectionMoveRight3DStop, selectionStopMovingXBehavior)
        // move 3D selection in y direction
        table:Add3D(selectionMoveUp3DStart, selectionStartMovingUpBehavior)
        table:Add3D(selectionMoveUp3DStop, selectionStopMovingYBehavior)
        table:Add3D(selectionMoveDown3DStart, selectionStartMovingDownBehavior)
        table:Add3D(selectionMoveDown3DStop, selectionStopMovingYBehavior)
        // move 3D selection in z direction
        table:Add3D(selectionMoveForward3DStart, selectionStartMovingForwardBehavior)
        table:Add3D(selectionMoveForward3DStop, selectionStopMovingZBehavior)
        table:Add3D(selectionMoveBackward3DStart, selectionStartMovingBackwardBehavior)
        table:Add3D(selectionMoveBackward3DStop, selectionStopMovingZBehavior)

        InputSet selectionMoveLeft2DStart = GetLeftArrowKey()
        InputSet selectionMoveLeft2DStop = GetLeftArrowKey()
        selectionMoveLeft2DStop:SetInputTrigger(selectionMoveLeft2DStop:FINISH)
        InputSet selectionMoveRight2DStart = GetRightArrowKey()
        InputSet selectionMoveRight2DStop = GetRightArrowKey()
        selectionMoveRight2DStop:SetInputTrigger(selectionMoveRight2DStop:FINISH)

        InputSet selectionMoveUp2DStart = GetUpArrowKey()
        InputSet selectionMoveUp2DStop = GetUpArrowKey()
        selectionMoveUp2DStop:SetInputTrigger(selectionMoveUp2DStop:FINISH)
        InputSet selectionMoveDown2DStart = GetDownArrowKey()
        InputSet selectionMoveDown2DStop = GetDownArrowKey()
        selectionMoveDown2DStop:SetInputTrigger(selectionMoveDown2DStop:FINISH)

        // move 2D selection in x direction
        table:Add2D(selectionMoveLeft2DStart, selectionStartMovingLeftBehavior)
        table:Add2D(selectionMoveLeft2DStop, selectionStopMovingXBehavior)
        table:Add2D(selectionMoveRight2DStart, selectionStartMovingRightBehavior)
        table:Add2D(selectionMoveRight2DStop, selectionStopMovingXBehavior)
        // move 2D selection in y direction
        table:Add2D(selectionMoveUp2DStart, selectionStartMovingUpBehavior)
        table:Add2D(selectionMoveUp2DStop, selectionStopMovingYBehavior)
        table:Add2D(selectionMoveDown2DStart, selectionStartMovingDownBehavior)
        table:Add2D(selectionMoveDown2DStop, selectionStopMovingYBehavior)

        InputSet toggleGridInput
        InputSet increaseGridUnitInput
        InputSet decreaseGridUnitInput
        InputSet openEditorFindDialogInput

        if manager:GetOperatingSystem():Contains("OS X")
            InputSet set
            toggleGridInput:SetKeyboardInput(keys:G)
            toggleGridInput:AddModifier(set:META)
            increaseGridUnitInput:SetKeyboardInput(keys:G)
            increaseGridUnitInput:AddModifier(set:META)
            increaseGridUnitInput:AddModifier(set:SHIFT)
            decreaseGridUnitInput:SetKeyboardInput(keys:G)
            decreaseGridUnitInput:AddModifier(set:META)
            decreaseGridUnitInput:AddModifier(set:ALT)
            openEditorFindDialogInput:SetKeyboardInput(keys:F)
            openEditorFindDialogInput:AddModifier(set:META)
        else
            InputSet set
            toggleGridInput:SetKeyboardInput(keys:G)
            toggleGridInput:AddModifier(set:CONTROL)
            increaseGridUnitInput:SetKeyboardInput(keys:G)
            increaseGridUnitInput:AddModifier(set:CONTROL)
            increaseGridUnitInput:AddModifier(set:SHIFT)
            decreaseGridUnitInput:SetKeyboardInput(keys:G)
            decreaseGridUnitInput:AddModifier(set:CONTROL)
            decreaseGridUnitInput:AddModifier(set:ALT)
            openEditorFindDialogInput:SetKeyboardInput(keys:F)
            openEditorFindDialogInput:AddModifier(set:CONTROL)
        end

        table:Add(toggleGridInput, toggleGridBehavior)
        table:Add(increaseGridUnitInput, increaseGridUnitBehavior)
        table:Add(decreaseGridUnitInput, decreaseGridUnitBehavior)

        table:Add(openEditorFindDialogInput, openFindDialogBehavior)

        InputSet selectionScaleUpSet
        selectionScaleUpSet:SetKeyboardInput(keys:EQUALS)
        selectionScaleUpSet = AddAltModifier(selectionScaleUpSet)
        InputSet selectionScaleDownSet
        selectionScaleDownSet:SetKeyboardInput(keys:MINUS)
        selectionScaleDownSet = AddAltModifier(selectionScaleDownSet)

        InputSet cursorSelectItemsInput
        cursorSelectItemsInput:SetKeyboardInput(keys:ENTER)

        table:Add(cursorSelectItemsInput, cursorSelectItemsBehavior)

        table:Add(selectionScaleUpSet, cursorIncreaseSizeBehavior)
        table:Add(selectionScaleDownSet, cursorDecreaseSizeBehavior)

        InputSet focusCameraSet
        focusCameraSet:SetKeyboardInput(keys:F)
        focusCameraSet:AddModifier(focusCameraSet:ALT)

        table:Add(focusCameraSet, focusCameraBehavior)

        // 2D camera set
        cameraItemTable2D:Add(reportLocation, reportLocationBehavior)

        cameraItemTable2D:Add(selectionMoveLeft2DStart, selectionStartMovingLeftBehavior)
        cameraItemTable2D:Add(selectionMoveLeft2DStop, selectionStopMovingXBehavior)
        cameraItemTable2D:Add(selectionMoveRight2DStart, selectionStartMovingRightBehavior)
        cameraItemTable2D:Add(selectionMoveRight2DStop, selectionStopMovingXBehavior)

        cameraItemTable2D:Add(selectionMoveUp2DStart, selectionStartMovingUpBehavior)
        cameraItemTable2D:Add(selectionMoveUp2DStop, selectionStopMovingYBehavior)
        cameraItemTable2D:Add(selectionMoveDown2DStart, selectionStartMovingDownBehavior)
        cameraItemTable2D:Add(selectionMoveDown2DStop, selectionStopMovingYBehavior)


        cameraItemTable2D:Add(selectionScaleUpSet, selectionScaleUpBehavior)
        cameraItemTable2D:Add(selectionScaleDownSet, selectionScaleDownBehavior)

        InputSet focusPropertiesSet
        if manager:GetOperatingSystem():Contains("OS X")
            focusPropertiesSet:SetKeyboardInput(keys:P)
            focusPropertiesSet:AddModifier(focusPropertiesSet:META)
        else
            focusPropertiesSet:SetKeyboardInput(keys:P)
            focusPropertiesSet:AddModifier(focusPropertiesSet:CONTROL)
        end

        cameraItemTable2D:Add(focusPropertiesSet, focusPropertiesBehavior)

        InputSet selectionCancelSet
        selectionCancelSet:SetKeyboardInput(keys:ESCAPE)
        cameraItemTable2D:Add(selectionCancelSet, selectionCancelBehavior)

        // 3D camera set
        cameraItemTable3D:Add(reportLocation, reportLocationBehavior)

        cameraItemTable3D:Add(selectionMoveLeft3DStart, selectionStartMovingLeftBehavior)
        cameraItemTable3D:Add(selectionMoveLeft3DStop, selectionStopMovingXBehavior)
        cameraItemTable3D:Add(selectionMoveRight3DStart, selectionStartMovingRightBehavior)
        cameraItemTable3D:Add(selectionMoveRight3DStop, selectionStopMovingXBehavior)

        cameraItemTable3D:Add(selectionMoveUp3DStart, selectionStartMovingUpBehavior)
        cameraItemTable3D:Add(selectionMoveUp3DStop, selectionStopMovingYBehavior)
        cameraItemTable3D:Add(selectionMoveDown3DStart, selectionStartMovingDownBehavior)
        cameraItemTable3D:Add(selectionMoveDown3DStop, selectionStopMovingYBehavior)

        cameraItemTable3D:Add(selectionMoveForward3DStart, selectionStartMovingForwardBehavior)
        cameraItemTable3D:Add(selectionMoveForward3DStop, selectionStopMovingZBehavior)
        cameraItemTable3D:Add(selectionMoveBackward3DStart, selectionStartMovingBackwardBehavior)
        cameraItemTable3D:Add(selectionMoveBackward3DStop, selectionStopMovingZBehavior)

        cameraItemTable3D:Add(selectionCancelSet, selectionCancelBehavior)

        cameraItemTable3D:Add(focusPropertiesSet, focusPropertiesBehavior)


        // 3D selection table
        selectionTable:Add(reportLocation, reportLocationBehavior)

        selectionTable:Add(selectionMoveLeft3DStart, selectionStartMovingLeftBehavior)
        selectionTable:Add(selectionMoveLeft3DStop, selectionStopMovingXBehavior)
        selectionTable:Add(selectionMoveRight3DStart, selectionStartMovingRightBehavior)
        selectionTable:Add(selectionMoveRight3DStop, selectionStopMovingXBehavior)

        selectionTable:Add(selectionMoveUp3DStart, selectionStartMovingUpBehavior)
        selectionTable:Add(selectionMoveUp3DStop, selectionStopMovingYBehavior)
        selectionTable:Add(selectionMoveDown3DStart, selectionStartMovingDownBehavior)
        selectionTable:Add(selectionMoveDown3DStop, selectionStopMovingYBehavior)

        selectionTable:Add(selectionMoveForward3DStart, selectionStartMovingForwardBehavior)
        selectionTable:Add(selectionMoveForward3DStop, selectionStopMovingZBehavior)
        selectionTable:Add(selectionMoveBackward3DStart, selectionStartMovingBackwardBehavior)
        selectionTable:Add(selectionMoveBackward3DStop, selectionStopMovingZBehavior)

        InputSet selectionRotateYawLeftStart = AddAltModifier(GetLeftArrowKey())
        InputSet selectionRotateYawLeftStop = AddAltModifier(GetLeftArrowKey())
        selectionRotateYawLeftStop:SetInputTrigger(selectionRotateYawLeftStop:FINISH)
        InputSet selectionRotateYawRightStart = AddAltModifier(GetRightArrowKey())
        InputSet selectionRotateYawRightStop = AddAltModifier(GetRightArrowKey())
        selectionRotateYawRightStop:SetInputTrigger(selectionRotateYawRightStop:FINISH)

        InputSet selectionRotatePitchUpStart = AddAltModifier(GetUpArrowKey())
        InputSet selectionRotatePitchUpStop = AddAltModifier(GetUpArrowKey())
        selectionRotatePitchUpStop:SetInputTrigger(selectionRotatePitchUpStop:FINISH)
        InputSet selectionRotatePitchDownStart = AddAltModifier(GetDownArrowKey())
        InputSet selectionRotatePitchDownStop = AddAltModifier(GetDownArrowKey())
        selectionRotatePitchDownStop:SetInputTrigger(selectionRotatePitchDownStop:FINISH)

        InputSet selectionRotateRollLeftStart
        InputSet selectionRotateRollLeftStop
        InputSet selectionRotateRollRightStart
        InputSet selectionRotateRollRightStop

        if manager:GetOperatingSystem():Contains("OS X")
            selectionRotateRollLeftStart = AddMetaModifier(AddAltModifier(GetLeftArrowKey()))
            selectionRotateRollLeftStop = AddMetaModifier(AddAltModifier(GetLeftArrowKey()))
            selectionRotateRollLeftStop:SetInputTrigger(selectionRotateRollLeftStop:FINISH)
            selectionRotateRollRightStart = AddMetaModifier(AddAltModifier(GetRightArrowKey()))
            selectionRotateRollRightStop = AddMetaModifier(AddAltModifier(GetRightArrowKey()))
            selectionRotateRollRightStop:SetInputTrigger(selectionRotateRollRightStop:FINISH)
        else
            selectionRotateRollLeftStart = AddControlModifier(AddAltModifier(GetLeftArrowKey()))
            selectionRotateRollLeftStop = AddControlModifier(AddAltModifier(GetLeftArrowKey()))
            selectionRotateRollLeftStop:SetInputTrigger(selectionRotateRollLeftStop:FINISH)
            selectionRotateRollRightStart = AddControlModifier(AddAltModifier(GetRightArrowKey()))
            selectionRotateRollRightStop = AddControlModifier(AddAltModifier(GetRightArrowKey()))
            selectionRotateRollRightStop:SetInputTrigger(selectionRotateRollRightStop:FINISH)
        end

        selectionTable:Add(selectionRotateYawLeftStart, selectionStartRotatingYawLeftBehavior)
        selectionTable:Add(selectionRotateYawLeftStop, selectionStopRotatingYawBehavior)
        selectionTable:Add(selectionRotateYawRightStart, selectionStartRotatingYawRightBehavior)
        selectionTable:Add(selectionRotateYawRightStop, selectionStopRotatingYawBehavior)

        selectionTable:Add(selectionRotatePitchUpStart, selectionStartRotatingPitchUpBehavior)
        selectionTable:Add(selectionRotatePitchUpStop, selectionStopRotatingPitchBehavior)
        selectionTable:Add(selectionRotatePitchDownStart, selectionStartRotatingPitchDownBehavior)
        selectionTable:Add(selectionRotatePitchDownStop, selectionStopRotatingPitchBehavior)

        selectionTable:Add(selectionRotateRollLeftStart, selectionStartRotatingRollLeftBehavior)
        selectionTable:Add(selectionRotateRollLeftStop, selectionStopRotatingRollBehavior)
        selectionTable:Add(selectionRotateRollRightStart, selectionStartRotatingRollRightBehavior)
        selectionTable:Add(selectionRotateRollRightStop, selectionStopRotatingRollBehavior)



        InputSet selectionScaleXUpSet
        selectionScaleXUpSet:SetKeyboardInput(keys:D)
        selectionScaleXUpSet = AddAltModifier(selectionScaleXUpSet)
        InputSet selectionScaleXDownSet
        selectionScaleXDownSet:SetKeyboardInput(keys:A)
        selectionScaleXDownSet = AddAltModifier(selectionScaleXDownSet)

        InputSet selectionScaleYUpSet
        selectionScaleYUpSet:SetKeyboardInput(keys:SPACE)
        selectionScaleYUpSet = AddAltModifier(selectionScaleYUpSet)
        InputSet selectionScaleYDownSet
        selectionScaleYDownSet:SetKeyboardInput(keys:X)
        selectionScaleYDownSet = AddAltModifier(selectionScaleYDownSet)

        InputSet selectionScaleZUpSet
        selectionScaleZUpSet:SetKeyboardInput(keys:W)
        selectionScaleZUpSet = AddAltModifier(selectionScaleZUpSet)
        InputSet selectionScaleZDownSet
        selectionScaleZDownSet:SetKeyboardInput(keys:S)
        selectionScaleZDownSet = AddAltModifier(selectionScaleZDownSet)


        selectionTable:Add(selectionScaleUpSet, selectionScaleUpBehavior)
        selectionTable:Add(selectionScaleDownSet, selectionScaleDownBehavior)

        selectionTable:Add(selectionScaleXUpSet, selectionScaleXUpBehavior)
        selectionTable:Add(selectionScaleXDownSet, selectionScaleXDownBehavior)

        selectionTable:Add(selectionScaleYUpSet, selectionScaleYUpBehavior)
        selectionTable:Add(selectionScaleYDownSet, selectionScaleYDownBehavior)

        selectionTable:Add(selectionScaleZUpSet, selectionScaleZUpBehavior)
        selectionTable:Add(selectionScaleZDownSet, selectionScaleZDownBehavior)

        InputSet selectionDeleteSet
        selectionDeleteSet:SetKeyboardInput(keys:FORWARD_DELETE)
        InputSet selectionDeleteSet2
        selectionDeleteSet2:SetKeyboardInput(keys:BACKSPACE)

        selectionTable:Add(selectionDeleteSet, selectionDeleteBehavior)
        selectionTable:Add(selectionDeleteSet2, selectionDeleteBehavior)
        selectionTable:Add(selectionCancelSet, selectionCancelBehavior)

        selectionTable:Add(toggleGridInput, toggleGridBehavior)
        selectionTable:Add(increaseGridUnitInput, increaseGridUnitBehavior)
        selectionTable:Add(decreaseGridUnitInput, decreaseGridUnitBehavior)

        selectionTable:Add(focusPropertiesSet, focusPropertiesBehavior)

        selectionTable:Add(openEditorFindDialogInput, openFindDialogBehavior)

        InputSet resetScaleSet        
        if manager:GetOperatingSystem():Contains("OS X")
            resetScaleSet:SetKeyboardInput(keys:R)
            resetScaleSet = AddMetaModifier(resetScaleSet)
        else
            resetScaleSet:SetKeyboardInput(keys:R)
            resetScaleSet = AddControlModifier(resetScaleSet)
        end

        selectionTable:Add(resetScaleSet, selectionResetScaleBehavior)

        // 2D selection
        selectionTable2D:Add(reportLocation, reportLocationBehavior)

        selectionTable2D:Add(selectionMoveLeft2DStart, selectionStartMovingLeftBehavior)
        selectionTable2D:Add(selectionMoveLeft2DStop, selectionStopMovingXBehavior)
        selectionTable2D:Add(selectionMoveRight2DStart, selectionStartMovingRightBehavior)
        selectionTable2D:Add(selectionMoveRight2DStop, selectionStopMovingXBehavior)

        selectionTable2D:Add(selectionMoveUp2DStart, selectionStartMovingUpBehavior)
        selectionTable2D:Add(selectionMoveUp2DStop, selectionStopMovingYBehavior)
        selectionTable2D:Add(selectionMoveDown2DStart, selectionStartMovingDownBehavior)
        selectionTable2D:Add(selectionMoveDown2DStop, selectionStopMovingYBehavior)

        InputSet selectionRotateForward2DStart = AddAltModifier(GetRightArrowKey())
        InputSet selectionRotateForward2DStop = AddAltModifier(GetRightArrowKey())
        selectionRotateForward2DStop:SetInputTrigger(selectionRotateForward2DStop:FINISH)
        InputSet selectionRotateBackward2DStart = AddAltModifier(GetLeftArrowKey())
        InputSet selectionRotateBackward2DStop = AddAltModifier(GetLeftArrowKey())
        selectionRotateBackward2DStop:SetInputTrigger(selectionRotateBackward2DStop:FINISH)

        selectionTable2D:Add(selectionRotateForward2DStart, selectionStartRotatingRollLeftBehavior)
        selectionTable2D:Add(selectionRotateForward2DStop, selectionStopRotatingRollBehavior)
        selectionTable2D:Add(selectionRotateBackward2DStart, selectionStartRotatingRollRightBehavior)
        selectionTable2D:Add(selectionRotateBackward2DStop, selectionStopRotatingRollBehavior)

        selectionTable2D:Add(selectionScaleUpSet, selectionScaleUpBehavior)
        selectionTable2D:Add(selectionScaleDownSet, selectionScaleDownBehavior)

        selectionTable2D:Add(selectionScaleXUpSet, selectionScaleXUpBehavior)
        selectionTable2D:Add(selectionScaleXDownSet, selectionScaleXDownBehavior)

        selectionTable2D:Add(selectionScaleYUpSet, selectionScaleYUpBehavior)
        selectionTable2D:Add(selectionScaleYDownSet, selectionScaleYDownBehavior)

        selectionTable2D:Add(selectionDeleteSet, selectionDeleteBehavior)
        selectionTable2D:Add(selectionDeleteSet2, selectionDeleteBehavior)
        selectionTable2D:Add(selectionCancelSet, selectionCancelBehavior)

        selectionTable2D:Add(toggleGridInput, toggleGridBehavior)
        selectionTable2D:Add(increaseGridUnitInput, increaseGridUnitBehavior)
        selectionTable2D:Add(decreaseGridUnitInput, decreaseGridUnitBehavior)

        selectionTable2D:Add(focusPropertiesSet, focusPropertiesBehavior)

        selectionTable2D:Add(openEditorFindDialogInput, openFindDialogBehavior)

        selectionTable2D:Add(resetScaleSet, selectionResetScaleBehavior)

        InputSet selectionHighlightDragInput
        selectionHighlightDragInput:SetDragItemInput()
        selectionHighlightDragInput:SetInputTrigger(selectionHighlightDragInput:CONTINUE)

        selectionTable2D:Add(selectionHighlightDragInput, selectionHighlightDragBehavior)

        selectionTable2D:Add(focusCameraSet, focusCameraBehavior)

        SceneConstants sceneConstants
        InputTable sceneItemTable
        sceneItemTable:SetIdentifier(sceneConstants:SCENE_ITEM_INPUT_GROUP)

        InputSet selectSceneItemInput = GetLeftClick()
        sceneItemTable:Add(selectSceneItemInput, selectSceneItemBehavior)

        sceneItemTable:Add(selectionHighlightDragInput, selectionHighlightDragBehavior)



        itemPreviewTable:Add(reportLocation, reportLocationBehavior)

        // The NewItemPreview shares the same movement/scaling behavior as SelectionHighlights.
        itemPreviewTable:Add(selectionMoveLeft3DStart, selectionStartMovingLeftBehavior)
        itemPreviewTable:Add(selectionMoveLeft3DStop, selectionStopMovingXBehavior)
        itemPreviewTable:Add(selectionMoveRight3DStart, selectionStartMovingRightBehavior)
        itemPreviewTable:Add(selectionMoveRight3DStop, selectionStopMovingXBehavior)
        itemPreviewTable:Add(selectionMoveUp3DStart, selectionStartMovingUpBehavior)
        itemPreviewTable:Add(selectionMoveUp3DStop, selectionStopMovingYBehavior)
        itemPreviewTable:Add(selectionMoveDown3DStart, selectionStartMovingDownBehavior)
        itemPreviewTable:Add(selectionMoveDown3DStop, selectionStopMovingYBehavior)
        itemPreviewTable:Add(selectionMoveForward3DStart, selectionStartMovingForwardBehavior)
        itemPreviewTable:Add(selectionMoveForward3DStop, selectionStopMovingZBehavior)
        itemPreviewTable:Add(selectionMoveBackward3DStart, selectionStartMovingBackwardBehavior)
        itemPreviewTable:Add(selectionMoveBackward3DStop, selectionStopMovingZBehavior)

        itemPreviewTable:Add(selectionRotateYawLeftStart, selectionStartRotatingYawLeftBehavior)
        itemPreviewTable:Add(selectionRotateYawLeftStop, selectionStopRotatingYawBehavior)
        itemPreviewTable:Add(selectionRotateYawRightStart, selectionStartRotatingYawRightBehavior)
        itemPreviewTable:Add(selectionRotateYawRightStop, selectionStopRotatingYawBehavior)
        itemPreviewTable:Add(selectionRotatePitchUpStart, selectionStartRotatingPitchUpBehavior)
        itemPreviewTable:Add(selectionRotatePitchUpStop, selectionStopRotatingPitchBehavior)
        itemPreviewTable:Add(selectionRotatePitchDownStart, selectionStartRotatingPitchDownBehavior)
        itemPreviewTable:Add(selectionRotatePitchDownStop, selectionStopRotatingPitchBehavior)
        itemPreviewTable:Add(selectionRotateRollLeftStart, selectionStartRotatingRollLeftBehavior)
        itemPreviewTable:Add(selectionRotateRollLeftStop, selectionStopRotatingRollBehavior)
        itemPreviewTable:Add(selectionRotateRollRightStart, selectionStartRotatingRollRightBehavior)
        itemPreviewTable:Add(selectionRotateRollRightStop, selectionStopRotatingRollBehavior)

        itemPreviewTable:Add(selectionScaleUpSet, selectionScaleUpBehavior)
        itemPreviewTable:Add(selectionScaleDownSet, selectionScaleDownBehavior)
        itemPreviewTable:Add(selectionScaleXUpSet, selectionScaleXUpBehavior)
        itemPreviewTable:Add(selectionScaleXDownSet, selectionScaleXDownBehavior)
        itemPreviewTable:Add(selectionScaleYUpSet, selectionScaleYUpBehavior)
        itemPreviewTable:Add(selectionScaleYDownSet, selectionScaleYDownBehavior)
        itemPreviewTable:Add(selectionScaleZUpSet, selectionScaleZUpBehavior)
        itemPreviewTable:Add(selectionScaleZDownSet, selectionScaleZDownBehavior)

        InputSet newItemCancel
        newItemCancel:SetKeyboardInput(keys:ESCAPE)
        InputSet newItemConfirm
        newItemConfirm:SetKeyboardInput(keys:ENTER)


        itemPreviewTable:Add(newItemCancel, itemCancelBehavior)
        itemPreviewTable:Add(newItemConfirm, itemConfirmBehavior)

        itemPreviewTable:Add(toggleGridInput, toggleGridBehavior)
        itemPreviewTable:Add(increaseGridUnitInput, increaseGridUnitBehavior)
        itemPreviewTable:Add(decreaseGridUnitInput, decreaseGridUnitBehavior)

        itemPreviewTable:Add(focusPropertiesSet, focusPropertiesBehavior)

        itemPreviewTable:Add(openEditorFindDialogInput, openFindDialogBehavior)

        itemPreviewTable:Add(resetScaleSet, selectionResetScaleBehavior)

        itemPreviewTable:Add(focusCameraSet, focusCameraBehavior)


        itemPreviewTable2D:Add(reportLocation, reportLocationBehavior)

        // The NewItemPreview shares the same movement/scaling behavior as SelectionHighlights.
        itemPreviewTable2D:Add(selectionMoveLeft2DStart, selectionStartMovingLeftBehavior)
        itemPreviewTable2D:Add(selectionMoveLeft2DStop, selectionStopMovingXBehavior)
        itemPreviewTable2D:Add(selectionMoveRight2DStart, selectionStartMovingRightBehavior)
        itemPreviewTable2D:Add(selectionMoveRight2DStop, selectionStopMovingXBehavior)
        itemPreviewTable2D:Add(selectionMoveUp2DStart, selectionStartMovingUpBehavior)
        itemPreviewTable2D:Add(selectionMoveUp2DStop, selectionStopMovingYBehavior)
        itemPreviewTable2D:Add(selectionMoveDown2DStart, selectionStartMovingDownBehavior)
        itemPreviewTable2D:Add(selectionMoveDown2DStop, selectionStopMovingYBehavior)

        itemPreviewTable2D:Add(selectionRotateForward2DStart, selectionStartRotatingRollLeftBehavior)
        itemPreviewTable2D:Add(selectionRotateForward2DStop, selectionStopRotatingRollBehavior)
        itemPreviewTable2D:Add(selectionRotateForward2DStart, selectionStartRotatingRollRightBehavior)
        itemPreviewTable2D:Add(selectionRotateForward2DStop, selectionStopRotatingRollBehavior)

        itemPreviewTable2D:Add(selectionScaleUpSet, selectionScaleUpBehavior)
        itemPreviewTable2D:Add(selectionScaleDownSet, selectionScaleDownBehavior)
        itemPreviewTable2D:Add(selectionScaleXUpSet, selectionScaleXUpBehavior)
        itemPreviewTable2D:Add(selectionScaleXDownSet, selectionScaleXDownBehavior)
        itemPreviewTable2D:Add(selectionScaleYUpSet, selectionScaleYUpBehavior)
        itemPreviewTable2D:Add(selectionScaleYDownSet, selectionScaleYDownBehavior)

        itemPreviewTable2D:Add(newItemCancel, itemCancelBehavior)
        itemPreviewTable2D:Add(newItemConfirm, itemConfirmBehavior)

        itemPreviewTable2D:Add(toggleGridInput, toggleGridBehavior)
        itemPreviewTable2D:Add(increaseGridUnitInput, increaseGridUnitBehavior)
        itemPreviewTable2D:Add(decreaseGridUnitInput, decreaseGridUnitBehavior)

        itemPreviewTable2D:Add(focusPropertiesSet, focusPropertiesBehavior)

        itemPreviewTable2D:Add(openEditorFindDialogInput, openFindDialogBehavior)

        itemPreviewTable2D:Add(resetScaleSet, selectionResetScaleBehavior)

        itemPreviewTable2D:Add(focusCameraSet, focusCameraBehavior)


        // properties dialog
        InputSet unfocusPropertiesSet1
        unfocusPropertiesSet1:SetKeyboardInput(keys:ESCAPE)
        InputSet unfocusPropertiesSet2
        unfocusPropertiesSet2:SetKeyboardInput(keys:ENTER)
        
        propertiesDialogTable:Add(unfocusPropertiesSet1, unfocusPropertiesBehavior)
        propertiesDialogTable:Add(unfocusPropertiesSet2, unfocusPropertiesBehavior)

        propertiesDialogTable:Add(openEditorFindDialogInput, openFindDialogBehavior)

        propertiesDialogTable:Add(focusCameraSet, focusCameraBehavior)

        // find dialog
        InputSet closeVisualEditorFindDialogSet1
        closeVisualEditorFindDialogSet1:SetKeyboardInput(keys:ESCAPE)
        InputSet closeVisualEditorFindDialogSet2
        closeVisualEditorFindDialogSet2:SetKeyboardInput(keys:ENTER)

        findTable:Add(closeVisualEditorFindDialogSet1, closeFindDialogBehavior)
        findTable:Add(closeVisualEditorFindDialogSet2, closeFindDialogBehavior)

        // palette item
        InputSet dragBeginSet
        dragBeginSet:SetDragItemInput()
        dragBeginSet:SetInputTrigger(dragBeginSet:BEGIN)

        InputSet dragContinueSet
        dragContinueSet:SetDragItemInput()
        dragContinueSet:SetInputTrigger(dragContinueSet:CONTINUE)

        InputSet dragEndSet
        dragEndSet:SetDragItemInput()
        dragEndSet:SetInputTrigger(dragEndSet:FINISH)

        PaletteItemStartDragBehavior paletteItemStartDragBehavior
        PaletteItemContinueDragBehavior paletteItemContinueDragBehavior
        PaletteItemDropBehavior paletteItemDropBehavior

        paletteItemContentTable:Add(dragBeginSet, paletteItemStartDragBehavior)
        paletteItemContentTable:Add(dragContinueSet, paletteItemContinueDragBehavior)
        paletteItemContentTable:Add(dragEndSet, paletteItemDropBehavior)


        gameInput:AddInputTable(table)
        gameInput:AddInputTable(selectionTable)
        gameInput:AddInputTable(selectionTable2D)
        gameInput:AddInputTable(cameraItemTable2D)
        gameInput:AddInputTable(cameraItemTable3D)
        gameInput:AddInputTable(sceneItemTable)
        gameInput:AddInputTable(itemPreviewTable)
        gameInput:AddInputTable(itemPreviewTable2D)
        gameInput:AddInputTable(propertiesDialogTable)
        gameInput:AddInputTable(findTable)
        gameInput:AddInputTable(paletteItemContentTable)
    end

    action SetupFlowChartInput(GameInput gameInput)
        InputTable flowchartTable
        flowchartTable:SetIdentifier("Flowchart")
        
        FlowchartNavigateLeftBehavior flowchartLeft
        FlowchartNavigateRightBehavior flowchartRight
        FlowchartNavigateDownBehavior flowchartDown
        FlowchartNavigateUpBehavior flowchartUp

        flowchartTable:Add(GetLeftArrowKey(), flowchartLeft)
        flowchartTable:Add(GetRightArrowKey(), flowchartRight)
        flowchartTable:Add(GetDownArrowKey(), flowchartDown)
        flowchartTable:Add(GetUpArrowKey(), flowchartUp)

        gameInput:AddInputTable(flowchartTable)
    end

    action SetupChartInput(GameInput gameInput)
        InputTable chartTable
        chartTable:SetIdentifier("Chart")

        InputSet numpadEnterSet
        numpadEnterSet:SetKeyboardInput(keys:NUMPAD_ENTER)

        InputSet swipeSet
        GestureEvent gestures
        swipeSet:SetGestureInput(gestures:SWIPE)

        InputSet tapSet
        tapSet:SetGestureInput(gestures:SINGLE_TAP)

        InputSet doubleTapSet
        doubleTapSet:SetGestureInput(gestures:DOUBLE_TAP)

        InputSet pinchSet
        pinchSet:SetGestureInput(gestures:PINCH)

        InputSet pinchContinue
        pinchContinue:SetGestureInput(gestures:PINCH)
        pinchContinue:SetInputTrigger(pinchContinue:CONTINUE)

        InputSet pinchEnd
        pinchEnd:SetGestureInput(gestures:PINCH)
        pinchEnd:SetInputTrigger(pinchEnd:FINISH)


        InputSet panSet
        panSet:SetGestureInput(gestures:PAN)
        
        InputSet longPressSet
        longPressSet:SetGestureInput(gestures:LONG_PRESS)

        InputSet escapeSet
        escapeSet:SetKeyboardInput(keys:ESCAPE)

        InputSet shiftEnterSet
        shiftEnterSet:SetKeyboardInput(keys:ENTER)
        shiftEnterSet:AddModifier(shiftEnterSet:SHIFT)

        InputSet shiftNumpadEnterSet
        shiftNumpadEnterSet:SetKeyboardInput(keys:NUMPAD_ENTER)
        shiftNumpadEnterSet:AddModifier(shiftNumpadEnterSet:SHIFT)

        InputSet tab
        tab:SetKeyboardInput(keys:TAB)

        InputSet shiftTab
        shiftTab:SetKeyboardInput(keys:TAB)

        InputSet pageDown
        pageDown:SetKeyboardInput(keys:PAGE_DOWN)

        InputSet pageUp
        pageUp:SetKeyboardInput(keys:PAGE_UP)

        ChartNavigateBehavior chartNavigateBehavior
        chartTable:Add(GetLeftArrowKey(), chartNavigateBehavior)
        chartTable:Add(GetRightArrowKey(), chartNavigateBehavior)
        chartTable:Add(GetUpArrowKey(), chartNavigateBehavior)
        chartTable:Add(GetDownArrowKey(), chartNavigateBehavior)
        chartTable:Add(GetEnterKey(), chartNavigateBehavior)
        chartTable:Add(numpadEnterSet, chartNavigateBehavior)
        chartTable:Add(shiftEnterSet, chartNavigateBehavior)
        chartTable:Add(shiftNumpadEnterSet, chartNavigateBehavior)
        chartTable:Add(swipeSet, chartNavigateBehavior)
        chartTable:Add(tapSet, chartNavigateBehavior)
        chartTable:Add(doubleTapSet, chartNavigateBehavior)
        chartTable:Add(pinchSet, chartNavigateBehavior)
        chartTable:Add(pinchContinue, chartNavigateBehavior)
        chartTable:Add(pinchEnd, chartNavigateBehavior)
        chartTable:Add(panSet, chartNavigateBehavior)
        chartTable:Add(longPressSet, chartNavigateBehavior)
        chartTable:Add(tab, chartNavigateBehavior)
        chartTable:Add(shiftTab, chartNavigateBehavior)
        chartTable:Add(pageUp, chartNavigateBehavior)
        chartTable:Add(pageDown, chartNavigateBehavior)
        gameInput:AddInputTable(chartTable)

        InputTable regressionLineTable
        regressionLineTable:SetIdentifier("RegressionLine")
        ChartMovableRegressionDragBehavior chartDragBehavior
        InputSet dragSet
        dragSet:SetDragItemInput()
        dragSet:SetInputTrigger(dragSet:CONTINUE)
        regressionLineTable:Add(dragSet, chartDragBehavior)
        gameInput:AddInputTable(regressionLineTable)
    end


    // This needs builds off the textbox and text field input tables so make sure those are added before this one
    action SetupBlockEditorInput(GameInput gameInput)
        InputTable table
        table:SetIdentifier("CodeEditor")
        
        KeyboardEvent keys

        GameStateManager manager


        InputSet downSet
        downSet:SetKeyboardInput(keys:DOWN)
        CodeEditorSelectionDownBehavior downBehavior
        table:Add(downSet, downBehavior)

        InputSet upSet
        upSet:SetKeyboardInput(keys:UP)
        CodeEditorSelectionUpBehavior upBehavior
        table:Add(upSet, upBehavior)

        InputSet shiftDownSet = downSet:Copy()
        shiftDownSet:AddModifier(shiftDownSet:SHIFT)
        CodeEditorMultipleSelectionDownBehavior shiftDownBehavior
        table:Add(shiftDownSet,shiftDownBehavior)
        
        InputSet shiftUpSet = upSet:Copy()
        shiftUpSet:AddModifier(shiftUpSet:SHIFT)
        CodeEditorMultipleSelectionUpBehavior shiftUpBehavior
        table:Add(shiftUpSet, shiftUpBehavior)
        
        InputSet tabSet
        tabSet:SetKeyboardInput(keys:TAB)
        CodeEditorSelectNextBehavior nextBehavior
        table:Add(tabSet, nextBehavior)

        InputSet shiftTabSet
        shiftTabSet:SetKeyboardInput(keys:TAB)
        shiftTabSet:AddModifier(tabSet:SHIFT)
        CodeEditorSelectPreviousBehavior previousBehavior
        table:Add(shiftTabSet, previousBehavior)

        InputSet escapeSet
        escapeSet:SetKeyboardInput(keys:ESCAPE)
        CodeEditorEscapeBehavior escapeBehavior
        table:Add(escapeSet, escapeBehavior)

        InputSet mouseScrollSet
        mouseScrollSet:SetInputType(mouseScrollSet:MOUSE_WHEEL_INPUT)
        ScrollableControlMouseScrollBehavior scrollBehavior
        table:Add(mouseScrollSet, scrollBehavior)

        InputSet enterSet
        enterSet:SetKeyboardInput(keys:ENTER)
        InputSet numpadEnterSet
        numpadEnterSet:SetKeyboardInput(keys:NUMPAD_ENTER)
        CodeEditorNewLineBehavior newLineBehavior
        table:Add(enterSet, newLineBehavior)
        table:Add(numpadEnterSet, newLineBehavior)

        //Editor Hint Application
        InputSet altEnterSet
        altEnterSet:SetKeyboardInput(keys:ENTER)
        altEnterSet:AddModifier(altEnterSet:ALT)

        InputSet altNumpadEnterSet
        altNumpadEnterSet:SetKeyboardInput(keys:NUMPAD_ENTER)
        altNumpadEnterSet:AddModifier(altEnterSet:ALT)

        CodeEditorHintBehavior codeEditorHintBehavior
        table:Add(altEnterSet, codeEditorHintBehavior)
        table:Add(altNumpadEnterSet, codeEditorHintBehavior)

        InputSet shiftF10SetCodeEditor
        shiftF10SetCodeEditor:SetKeyboardInput(keys:F10)
        shiftF10SetCodeEditor:AddModifier(shiftF10SetCodeEditor:SHIFT)
        CodeEditorOpenPopupMenuBehavior codeEditorOpenPopupMenuBehavior
        table:Add(shiftF10SetCodeEditor, codeEditorOpenPopupMenuBehavior)

        InputSet rightClickSetCodeEditor
        rightClickSetCodeEditor:SetMouseInput(mouse:RIGHT)
        table:Add(rightClickSetCodeEditor, codeEditorOpenPopupMenuBehavior)

        InputSet deleteSet
        deleteSet:SetKeyboardInput(keys:FORWARD_DELETE)
        CodeEditorDeleteBlockBehavior deleteBehavior
        table:Add(deleteSet, deleteBehavior)
        
        InputSet backspaceSet
        backspaceSet:SetKeyboardInput(keys:BACKSPACE)
        table:Add(backspaceSet,deleteBehavior)
        
        CodeEditorFreeformEditingBehavior freeformBehavior

        InputSet typingSet
        typingSet:SetInputType(typingSet:TEXT_INPUT)

        InputSet leftSet
        leftSet:SetKeyboardInput(keys:LEFT)
        InputSet rightSet
        rightSet:SetKeyboardInput(keys:RIGHT)

        InputSet shiftLeftSet = leftSet:Copy()
        shiftLeftSet:AddModifier(shiftLeftSet:SHIFT)
        InputSet shiftRightSet = rightSet:Copy()
        shiftRightSet:AddModifier(shiftRightSet:SHIFT)

        InputSet controlLeftSet = leftSet:Copy()
        controlLeftSet:AddModifier(shiftLeftSet:CONTROL)
        InputSet controlRightSet = rightSet:Copy()
        controlRightSet:AddModifier(shiftRightSet:CONTROL)

        InputSet controlShiftLeftSet = shiftLeftSet:Copy()
        controlShiftLeftSet:AddModifier(shiftLeftSet:CONTROL)
        InputSet controlShiftRightSet = shiftRightSet:Copy()
        controlShiftRightSet:AddModifier(shiftRightSet:CONTROL)

        InputSet homeSet
        homeSet:SetKeyboardInput(keys:HOME)
        InputSet endSet
        endSet:SetKeyboardInput(keys:END)
        
        InputSet shiftHomeSet = homeSet:Copy()
        shiftHomeSet:AddModifier(homeSet:SHIFT)
        InputSet shiftEndSet = endSet:Copy()
        shiftEndSet:AddModifier(endSet:SHIFT)
//Behaviors for copy/cut/paste
        CodeEditorCopyToClipboardBehavior copyToClipboardBehavior
        if manager:GetOperatingSystem():Contains("OS X")
            // cut copy paste
            InputSet blockControlC
            blockControlC:SetKeyboardInput(keys:C)
            blockControlC:AddModifier(blockControlC:META)
            table:Add(blockControlC, copyToClipboardBehavior)
            
            InputSet blockControlX
            blockControlX:SetKeyboardInput(keys:X)
            blockControlX:AddModifier(blockControlX:META)

            InputSet blockControlV
            blockControlV:SetKeyboardInput(keys:V)
            blockControlV:AddModifier(blockControlV:META)

            //select all
            InputSet blockControlA
            blockControlA:SetKeyboardInput(keys:A)
            blockControlA:AddModifier(blockControlA:META)
            CodeEditorSelectAllBehavior codeEditorSelectAllBehavior
            table:Add(blockControlA,codeEditorSelectAllBehavior)

            //undo/redo
            InputSet blockControlZ
            blockControlZ:SetKeyboardInput(keys:Z)
            blockControlZ:AddModifier(blockControlZ:META)
            CodeEditorUndoBehavior codeEditorUndoBehavior
            table:Add(blockControlZ, codeEditorUndoBehavior)

            InputSet blockControlY
            blockControlY:SetKeyboardInput(keys:Y)
            blockControlY:AddModifier(blockControlY:META)
            CodeEditorRedoBehavior codeEditorRedoBehavior
            table:Add(blockControlY, codeEditorRedoBehavior)
        else
            // cut copy paste
            InputSet blockControlC
            blockControlC:SetKeyboardInput(keys:C)
            blockControlC:AddModifier(blockControlC:CONTROL)
            table:Add(blockControlC, copyToClipboardBehavior)

            InputSet blockControlX
            blockControlX:SetKeyboardInput(keys:X)
            blockControlX:AddModifier(blockControlX:CONTROL)
//            TextBoxCutToClipboardBehavior textBoxCutToClipboardBehavior
//            textBoxTable:Add(textBoxControlX, textBoxCutToClipboardBehavior)

            InputSet blockControlV
            blockControlV:SetKeyboardInput(keys:V)
            blockControlV:AddModifier(blockControlV:CONTROL)
//            TextBoxPasteFromClipboardBehavior textBoxPasteFromClipboardBehavior
//            textBoxTable:Add(textBoxControlV, textBoxPasteFromClipboardBehavior)

            InputSet blockControlA
            blockControlA:SetKeyboardInput(keys:A)
            blockControlA:AddModifier(blockControlA:CONTROL)
            CodeEditorSelectAllBehavior codeEditorSelectAllBehavior
            table:Add(blockControlA,codeEditorSelectAllBehavior)

            //undo/redo
            InputSet blockControlZ
            blockControlZ:SetKeyboardInput(keys:Z)
            blockControlZ:AddModifier(blockControlZ:CONTROL)
            CodeEditorUndoBehavior codeEditorUndoBehavior
            table:Add(blockControlZ, codeEditorUndoBehavior)

            InputSet blockControlY
            blockControlY:SetKeyboardInput(keys:Y)
            blockControlY:AddModifier(blockControlY:CONTROL)
            CodeEditorRedoBehavior codeEditorRedoBehavior
            table:Add(blockControlY, codeEditorRedoBehavior)
        end


        table:Add(typingSet, freeformBehavior)
        table:Add(shiftLeftSet, freeformBehavior)
        table:Add(shiftRightSet, freeformBehavior)
        table:Add(controlLeftSet, freeformBehavior)
        table:Add(controlRightSet, freeformBehavior)
        table:Add(controlShiftLeftSet, freeformBehavior)
        table:Add(controlShiftRightSet, freeformBehavior)
        table:Add(homeSet, freeformBehavior)
        table:Add(endSet, freeformBehavior)
        table:Add(shiftHomeSet, freeformBehavior)
        table:Add(shiftEndSet, freeformBehavior)

        CodeEditorFreeformEditingBehavior forceFreeformBehavior
        forceFreeformBehavior:SetForceEditing(true)
        
        table:Add(leftSet, forceFreeformBehavior)
        table:Add(rightSet, forceFreeformBehavior)
        
        gameInput:AddInputTable(table)


        InputTable editFieldTable = gameInput:GetInputTable("TextField"):Copy()
        editFieldTable:SetIdentifier("EditField")
        editFieldTable:RemoveKey(downSet)
        editFieldTable:RemoveKey(upSet)
        editFieldTable:Add(downSet, downBehavior)
        editFieldTable:Add(upSet, upBehavior)
        gameInput:AddInputTable(editFieldTable)

        
        InputTable editBoxTable = gameInput:GetInputTable("TextBox"):Copy()
        editBoxTable:SetIdentifier("EditBox")
        editBoxTable:RemoveKey(downSet)
        editBoxTable:RemoveKey(upSet)
        editBoxTable:RemoveKey(enterSet)
        editBoxTable:RemoveKey(mouseScrollSet)
        editBoxTable:Add(downSet, downBehavior)
        editBoxTable:Add(upSet, upBehavior)
        gameInput:AddInputTable(editBoxTable)
    end

    action SetupScrollBarControlInput(GameInput gameInput)
        InputTable scrollBarTable
        scrollBarTable:SetIdentifier("ScrollBarControl")
        
        InputSet dragStartSet
        dragStartSet:SetDragItemInput()
        dragStartSet:SetInputTrigger(dragStartSet:BEGIN)
        InputSet dragSet
        dragSet:SetDragItemInput()
        dragSet:SetInputTrigger(dragSet:CONTINUE)
        
        ScrollBarDragBehavior barDragBehavior
        scrollBarTable:Add(dragStartSet, barDragBehavior)
        scrollBarTable:Add(dragSet, barDragBehavior)

        /*
        Giving the scroll bars an empty behavior for mouse click will make them intercept
        the mouse clicks even if it isn't going to do anything with them. Necessary for e.g.
        TextBox to ensure attempts to use the scroll bars don't propagate down as clicks
        in the text area.
        */
        InputSet leftClickSet
        leftClickSet:SetMouseInput(mouse:LEFT)
        Behavior emptyBehavior
        scrollBarTable:Add(leftClickSet, emptyBehavior)

        gameInput:AddInputTable(scrollBarTable)
    end

    action SetupScrollPaneInput(GameInput gameInput)
        InputTable scrollPaneTable
        scrollPaneTable:SetIdentifier("ScrollPane")

        InputSet mouseScrollSet
        mouseScrollSet:SetInputType(mouseScrollSet:MOUSE_WHEEL_INPUT)
        ScrollableControlMouseScrollBehavior scrollBehavior
        scrollPaneTable:Add(mouseScrollSet, scrollBehavior)

        gameInput:AddInputTable(scrollPaneTable)
    end

end